<view class="modify-container">
  <view class="page-header">
    <text class="page-title">åˆ æ”¹é¡¹ç›®</text>
    <text class="page-subtitle">é€‰æ‹©é¡¹ç›®å’Œåˆ—è¿›è¡Œä¿®æ”¹æˆ–æ·»åŠ å†…å®¹</text>
  </view>

  <!-- æ­¥éª¤1ï¼šé€‰æ‹©é¡¹ç›® -->
  <view class="step-section" wx:if="{{currentStep === 1}}">
    <view class="step-header">
      <text class="step-title">æ­¥éª¤1ï¼šé€‰æ‹©ç¬¬å‡ ä¸ªé¡¹ç›®</text>
    </view>

    <view class="project-list">
      <view
        class="project-item {{selectedProject && selectedProject.id === item.id ? 'selected' : ''}}"
        wx:for="{{projectList}}"
        wx:key="id"
        bindtap="selectProject"
        data-project="{{item}}"
      >
        <view class="project-number">ç¬¬{{index + 1}}ä¸ª</view>
        <view class="project-info">
          <view class="project-name">{{item.name}}</view>
          <view class="project-desc">{{item.description}}</view>
        </view>
        <view class="select-icon">{{selectedProject && selectedProject.id === item.id ? 'âœ“' : 'â—‹'}}</view>
      </view>
    </view>

    <view class="button-group">
      <button class="next-btn" bindtap="nextStep" disabled="{{!selectedProject}}">ä¸‹ä¸€æ­¥</button>
      <button class="cancel-btn" bindtap="cancel">å–æ¶ˆ</button>
    </view>
  </view>

  <!-- æ­¥éª¤2ï¼šé€‰æ‹©åˆ— -->
  <view class="step-section" wx:if="{{currentStep === 2}}">
    <view class="step-header">
      <text class="step-title">æ­¥éª¤2ï¼šé€‰æ‹©ç¬¬å‡ åˆ—</text>
      <text class="step-subtitle">å½“å‰é¡¹ç›®ï¼š{{selectedProject.name}}</text>
    </view>

    <view class="column-list">
      <view
        class="column-item {{selectedColumn && selectedColumn.key === item.key ? 'selected' : ''}}"
        wx:for="{{projectColumns}}"
        wx:key="key"
        bindtap="selectColumn"
        data-column="{{item}}"
      >
        <view class="column-number">ç¬¬{{index + 1}}åˆ—</view>
        <view class="column-info">
          <view class="column-name">{{item.name}}</view>
          <view class="column-current">å½“å‰å†…å®¹ï¼š{{selectedProject[item.key] || 'æš‚æ— '}}</view>
        </view>
        <view class="select-icon">{{selectedColumn && selectedColumn.key === item.key ? 'âœ“' : 'â—‹'}}</view>
      </view>
    </view>

    <view class="button-group">
      <button class="next-btn" bindtap="nextStep" disabled="{{!selectedColumn}}">ä¸‹ä¸€æ­¥</button>
      <button class="back-btn" bindtap="prevStep">ä¸Šä¸€æ­¥</button>
    </view>
  </view>

  <!-- æ­¥éª¤3ï¼šé€‰æ‹©æ“ä½œç±»å‹ -->
  <view class="step-section" wx:if="{{currentStep === 3}}">
    <view class="step-header">
      <text class="step-title">æ­¥éª¤3ï¼šé€‰æ‹©æ“ä½œç±»å‹</text>
      <text class="step-subtitle">{{selectedProject.name}} - {{selectedColumn.name}}</text>
    </view>

    <view class="action-list">
      <view
        class="action-item {{selectedAction === 'modify' ? 'selected' : ''}}"
        bindtap="selectAction"
        data-action="modify"
      >
        <view class="action-icon">âœï¸</view>
        <view class="action-info">
          <view class="action-name">ä¿®æ”¹å†…å®¹</view>
          <view class="action-desc">ä¿®æ”¹å½“å‰åˆ—çš„æ–‡å­—å†…å®¹</view>
        </view>
        <view class="select-icon">{{selectedAction === 'modify' ? 'âœ“' : 'â—‹'}}</view>
      </view>

      <view
        class="action-item {{selectedAction === 'add' ? 'selected' : ''}}"
        bindtap="selectAction"
        data-action="add"
      >
        <view class="action-icon">ğŸ“</view>
        <view class="action-info">
          <view class="action-name">æ·»åŠ å†…å®¹</view>
          <view class="action-desc">æ·»åŠ å›¾ç‰‡ã€è§†é¢‘ã€æ—¶é—´ã€åœ°ç‚¹ã€äººå‘˜ç­‰</view>
        </view>
        <view class="select-icon">{{selectedAction === 'add' ? 'âœ“' : 'â—‹'}}</view>
      </view>

      <view
        class="action-item {{selectedAction === 'delete' ? 'selected' : ''}}"
        bindtap="selectAction"
        data-action="delete"
      >
        <view class="action-icon">ğŸ—‘ï¸</view>
        <view class="action-info">
          <view class="action-name">åˆ é™¤å†…å®¹</view>
          <view class="action-desc">åˆ é™¤é¡¹ç›®è¿›åº¦è®°å½•</view>
        </view>
        <view class="select-icon">{{selectedAction === 'delete' ? 'âœ“' : 'â—‹'}}</view>
      </view>
    </view>

    <view class="button-group">
      <button class="next-btn" bindtap="nextStep" disabled="{{!selectedAction}}">ä¸‹ä¸€æ­¥</button>
      <button class="back-btn" bindtap="prevStep">ä¸Šä¸€æ­¥</button>
    </view>
  </view>

  <!-- æ­¥éª¤4ï¼šä¿®æ”¹å†…å®¹ -->
  <view class="step-section" wx:if="{{currentStep === 4 && selectedAction === 'modify'}}">
    <view class="step-header">
      <text class="step-title">ä¿®æ”¹å†…å®¹</text>
      <text class="step-subtitle">{{selectedProject.name}} - {{selectedColumn.name}}</text>
    </view>

    <view class="modify-content">
      <view class="current-content">
        <text class="content-label">å½“å‰å†…å®¹ï¼š</text>
        <text class="content-text">{{selectedProject[selectedColumn.key] || 'æš‚æ— å†…å®¹'}}</text>
      </view>

      <view class="new-content">
        <text class="content-label">æ–°å†…å®¹ï¼š</text>
        <textarea
          class="content-input"
          placeholder="è¯·è¾“å…¥æ–°çš„å†…å®¹"
          value="{{newContent}}"
          bindinput="onNewContentInput"
          maxlength="1000"
        />
      </view>
    </view>

    <view class="button-group">
      <button class="save-btn" bindtap="saveModification">ä¿å­˜ä¿®æ”¹</button>
      <button class="back-btn" bindtap="prevStep">ä¸Šä¸€æ­¥</button>
    </view>
  </view>

  <!-- æ­¥éª¤4ï¼šæ·»åŠ å†…å®¹ -->
  <view class="step-section" wx:if="{{currentStep === 4 && selectedAction === 'add'}}">
    <view class="step-header">
      <text class="step-title">æ·»åŠ å†…å®¹</text>
      <text class="step-subtitle">{{selectedProject.name}} - {{selectedColumn.name}}</text>
    </view>

    <view class="add-content">
      <view class="upload-options">
        <view class="upload-item" bindtap="uploadImage">
          <view class="upload-icon">ğŸ–¼ï¸</view>
          <text class="upload-text">æ·»åŠ å›¾ç‰‡</text>
        </view>

        <view class="upload-item" bindtap="uploadVideo">
          <view class="upload-icon">ğŸ¥</view>
          <text class="upload-text">æ·»åŠ è§†é¢‘</text>
        </view>

        <view class="upload-item" bindtap="addTime">
          <view class="upload-icon">â°</view>
          <text class="upload-text">æ·»åŠ æ—¶é—´</text>
        </view>

        <view class="upload-item" bindtap="addLocation">
          <view class="upload-icon">ğŸ“</view>
          <text class="upload-text">æ·»åŠ åœ°ç‚¹</text>
        </view>

        <view class="upload-item" bindtap="addPerson">
          <view class="upload-icon">ğŸ‘¤</view>
          <text class="upload-text">æ·»åŠ äººå‘˜</text>
        </view>

        <view class="upload-item" bindtap="uploadDocument">
          <view class="upload-icon">ğŸ“„</view>
          <text class="upload-text">æ·»åŠ æ–°é—»ç¨¿</text>
        </view>
      </view>

      <!-- æ—¶é—´è¾“å…¥æ¡† -->
      <view class="input-section" wx:if="{{showTimeInput}}">
        <text class="input-label">æ·»åŠ æ—¶é—´</text>
        <picker
          mode="date"
          value="{{selectedDate}}"
          bindchange="onDateChange"
          class="form-input"
        >
          <view class="picker-text">{{selectedDate || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
        </picker>
        <picker
          mode="time"
          value="{{selectedTime}}"
          bindchange="onTimeChange"
          class="form-input"
        >
          <view class="picker-text">{{selectedTime || 'è¯·é€‰æ‹©æ—¶é—´'}}</view>
        </picker>
        <button class="add-btn" bindtap="confirmAddTime">æ·»åŠ æ—¶é—´</button>
      </view>

      <!-- åœ°ç‚¹è¾“å…¥æ¡† -->
      <view class="input-section" wx:if="{{showLocationInput}}">
        <text class="input-label">æ·»åŠ åœ°ç‚¹</text>
        <input
          class="form-input"
          placeholder="è¯·è¾“å…¥åœ°ç‚¹åç§°"
          value="{{locationName}}"
          bindinput="onLocationInput"
        />
        <button class="add-btn" bindtap="confirmAddLocation">æ·»åŠ åœ°ç‚¹</button>
      </view>

      <!-- äººå‘˜è¾“å…¥æ¡† -->
      <view class="input-section" wx:if="{{showPersonInput}}">
        <text class="input-label">æ·»åŠ äººå‘˜</text>
        <input
          class="form-input"
          placeholder="è¯·è¾“å…¥äººå‘˜å§“å"
          value="{{personName}}"
          bindinput="onPersonNameInput"
        />
        <input
          class="form-input"
          placeholder="è¯·è¾“å…¥äººå‘˜èŒåŠ¡"
          value="{{personTitle}}"
          bindinput="onPersonTitleInput"
        />
        <button class="add-btn" bindtap="confirmAddPerson">æ·»åŠ äººå‘˜</button>
      </view>

      <!-- å·²æ·»åŠ çš„å†…å®¹åˆ—è¡¨ -->
      <view class="added-content" wx:if="{{addedItems.length > 0}}">
        <text class="content-label">å·²æ·»åŠ çš„å†…å®¹ï¼š</text>
        <view
          class="added-item"
          wx:for="{{addedItems}}"
          wx:key="index"
        >
          <text class="item-type">{{item.type}}</text>
          <text class="item-name">{{item.name}}</text>
          <view class="item-actions">
            <button class="remove-btn" bindtap="removeItem" data-index="{{index}}">åˆ é™¤</button>
          </view>
        </view>
      </view>
    </view>

    <view class="button-group">
      <button class="save-btn" bindtap="saveAddition" disabled="{{addedItems.length === 0}}">ä¿å­˜æ·»åŠ </button>
      <button class="back-btn" bindtap="prevStep">ä¸Šä¸€æ­¥</button>
    </view>
  </view>

  <!-- æ­¥éª¤4ï¼šåˆ é™¤å†…å®¹ -->
  <view class="step-section" wx:if="{{currentStep === 4 && selectedAction === 'delete'}}">
    <view class="step-header">
      <text class="step-title">åˆ é™¤å†…å®¹</text>
      <text class="step-subtitle">{{selectedProject.name}} - {{selectedColumn.name}}</text>
    </view>

    <!-- æ—¶é—´ç­›é€‰åŒºåŸŸ -->
    <view class="delete-filter-section">
      <view class="filter-title-area">
        <view class="filter-icon">ğŸ•’</view>
        <text class="filter-main-title">æ—¶é—´ç­›é€‰é€‰æ‹©æ—¶é—´æ®µæŸ¥çœ‹è¿›åº¦è®°å½•</text>
      </view>

      <!-- æ—¶é—´æ®µæŒ‰é’® -->
      <view class="time-filter-buttons">
        <view class="time-filter-item {{timeFilter === 'week' ? 'active' : ''}}" bindtap="filterByTime" data-filter="week">
          <text class="filter-text">æœ€è¿‘ä¸€å‘¨</text>
        </view>
        <view class="time-filter-item {{timeFilter === 'month' ? 'active' : ''}}" bindtap="filterByTime" data-filter="month">
          <text class="filter-text">æœ€è¿‘ä¸€æœˆ</text>
        </view>
        <view class="time-filter-item {{timeFilter === 'year' ? 'active' : ''}}" bindtap="filterByTime" data-filter="year">
          <text class="filter-text">æœ€è¿‘ä¸€å¹´</text>
        </view>
        <view class="time-filter-item {{timeFilter === 'all' ? 'active' : ''}}" bindtap="filterByTime" data-filter="all">
          <text class="filter-text">æŸ¥çœ‹å…¨éƒ¨</text>
        </view>
      </view>

      <!-- è‡ªå®šä¹‰æ—¥æœŸé€‰æ‹© -->
      <view class="custom-date-area">
        <picker mode="date" value="{{selectedDeleteDate}}" bindchange="onDeleteDateChange">
          <view class="custom-date-picker">
            <view class="date-icon">ğŸ“…</view>
            <text class="date-text">{{selectedDeleteDate || 'é€‰æ‹©å…·ä½“æ—¥æœŸ'}}</text>
            <view class="date-arrow">â–¼</view>
          </view>
        </picker>
      </view>
    </view>

    <!-- ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡ -->
    <view class="delete-stats-area">
      <view class="stats-item">
        <text class="stats-num">{{filteredProgressList.length}}</text>
        <text class="stats-desc">å½“å‰è®°å½•æ•°</text>
      </view>
      <view class="stats-item">
        <text class="stats-num">{{selectedDeleteCount}}</text>
        <text class="stats-desc">å·²é€‰æ‹©</text>
      </view>
    </view>

    <!-- æ‰¹é‡æ“ä½œæŒ‰é’® -->
    <view class="batch-operation-area" wx:if="{{selectedDeleteCount > 0}}">
      <view class="batch-select-btn" bindtap="selectAllProgress">
        <text class="batch-text">{{isAllProgressSelected ? 'å–æ¶ˆå…¨é€‰' : 'å…¨é€‰'}}</text>
      </view>
      <view class="batch-delete-btn" bindtap="batchDeleteProgress">
        <text class="batch-text">æ‰¹é‡åˆ é™¤ ({{selectedDeleteCount}})</text>
      </view>
    </view>

    <!-- è¿›åº¦è®°å½•åŒºåŸŸ -->
    <view class="delete-progress-area">
      <view class="progress-area-header">
        <view class="progress-icon">ğŸ“‹</view>
        <view class="progress-header-text">
          <text class="progress-main-text">è¿›åº¦è®°å½•ç‚¹å‡»é€‰æ‹©è¦åˆ é™¤çš„è®°å½•</text>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="delete-empty-state" wx:if="{{filteredProgressList.length === 0}}">
        <view class="empty-icon-large">ğŸ“­</view>
        <text class="empty-message">æš‚æ— ç¬¦åˆæ¡ä»¶çš„è¿›åº¦è®°å½•</text>
      </view>

      <!-- è¿›åº¦è®°å½•åˆ—è¡¨ -->
      <view class="delete-progress-list" wx:if="{{filteredProgressList.length > 0}}">
        <view
          class="delete-progress-item {{item.selected ? 'item-selected' : ''}}"
          wx:for="{{filteredProgressList}}"
          wx:key="id"
          bindtap="toggleProgressSelect"
          data-id="{{item.id}}"
        >
          <!-- é€‰æ‹©æ¡† -->
          <view class="item-checkbox {{item.selected ? 'checkbox-checked' : ''}}">
            <text class="checkbox-icon">{{item.selected ? 'âœ“' : ''}}</text>
          </view>

          <!-- è¿›åº¦ä¿¡æ¯ -->
          <view class="item-content">
            <view class="item-header">
              <view class="item-time-info">
                <view class="time-status-dot {{item.status}}"></view>
                <view class="time-details">
                  <text class="item-date">{{item.date}}</text>
                  <text class="item-time">{{item.time}}</text>
                </view>
              </view>
              <text class="item-status {{item.status}}">{{item.statusText}}</text>
            </view>

            <text class="item-title">{{item.title}}</text>

            <view class="item-details">
              <view class="detail-row">
                <text class="detail-label">ğŸ“</text>
                <text class="detail-value">{{item.location}}</text>
              </view>
              <view class="detail-row">
                <text class="detail-label">ğŸ‘¤</text>
                <text class="detail-value">{{item.person}}</text>
              </view>
            </view>
          </view>

          <!-- åˆ é™¤æŒ‰é’® -->
          <view class="item-delete-btn" bindtap="singleDeleteProgress" data-id="{{item.id}}" catchtap="singleDeleteProgress">
            <text class="delete-btn-icon">ğŸ—‘ï¸</text>
          </view>
        </view>
      </view>
    </view>

    <view class="button-group">
      <button class="back-btn" bindtap="prevStep">ä¸Šä¸€æ­¥</button>
    </view>
  </view>
</view>
