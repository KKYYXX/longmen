<view class="modify-container">
  <view class="page-header">
    <text class="page-title">删改项目</text>
    <text class="page-subtitle">选择项目和列进行修改或添加内容</text>
  </view>

  <!-- 步骤1：选择项目 -->
  <view class="step-section" wx:if="{{currentStep === 1}}">
    <view class="step-header">
      <text class="step-title">步骤1：选择第几个项目</text>
    </view>
    
    <!-- 项目数量信息 -->
    <view class="project-count-info" wx:if="{{!loading && projectList.length > 0}}">
      <text class="count-text">共找到 {{projectList.length}} 个项目</text>
    </view>
    
    <!-- 搜索框 -->
    <view class="search-section" wx:if="{{!loading && projectList.length > 0}}">
      <view class="search-box">
        <text class="search-icon">🔍</text>
        <input class="search-input"
               placeholder="搜索项目名称..."
               value="{{searchKeyword}}"
               bindinput="onSearchInput"
               bindconfirm="onSearch"/>
        <view class="search-actions">
          <text class="clear-search-btn" bindtap="clearSearch" wx:if="{{searchKeyword}}">✕</text>
          <text class="search-btn" bindtap="onSearch">搜索</text>
        </view>
      </view>
      
      <!-- 搜索结果信息 -->
      <view class="search-result-info" wx:if="{{searchKeyword && filteredProjectList.length > 0}}">
        <text class="result-text">找到 {{filteredProjectList.length}} 个匹配项目</text>
      </view>
    </view>

    <view class="project-list">
      <!-- 加载状态显示 -->
      <view class="loading-state" wx:if="{{loading}}">
        <text class="loading-icon">⏳</text>
        <text class="loading-text">正在加载项目列表...</text>
      </view>
      
      <!-- 项目列表 - 支持搜索过滤 -->
      <view
        class="project-item {{selectedProject && selectedProject.id === item.id ? 'selected' : ''}}"
        wx:for="{{searchKeyword ? filteredProjectList : projectList}}"
        wx:key="id"
        bindtap="selectProject"
        data-project="{{item}}"
        wx:if="{{!loading}}"
      >
        <view class="project-number">第{{index + 1}}个</view>
        <view class="project-info">
          <view class="project-name">{{item.name}}</view>
          <view class="project-desc">{{item.description}}</view>
          <view class="project-meta">
            <text class="meta-item">ID: {{item.id}}</text>
          </view>
        </view>
        <view class="select-icon">{{selectedProject && selectedProject.id === item.id ? '✓' : '○'}}</view>
      </view>
      
      <!-- 空状态显示 -->
      <view class="empty-state" wx:if="{{projectList.length === 0 && !loading}}">
        <text class="empty-icon">🏗️</text>
        <text class="empty-text">暂无项目数据</text>
        <text class="empty-desc">请检查网络连接或联系管理员</text>
        <view class="retry-btn" bindtap="loadProjectList">
          <text class="retry-icon">🔄</text>
          <text class="retry-text">重新加载</text>
        </view>
      </view>
      
      <!-- 搜索无结果提示 -->
      <view class="search-no-result" wx:if="{{searchKeyword && filteredProjectList.length === 0 && !loading}}">
        <text class="no-result-icon">🔍</text>
        <text class="no-result-text">未找到匹配的项目</text>
        <text class="no-result-desc">请尝试其他关键词</text>
        <view class="clear-search-btn-large" bindtap="clearSearch">
          <text class="clear-text">清除搜索</text>
        </view>
      </view>
    </view>

    <view class="button-group">
      <button class="next-btn" bindtap="nextStep" disabled="{{!selectedProject}}">下一步</button>
      <button class="cancel-btn" bindtap="cancel">取消</button>
    </view>
  </view>

  <!-- 步骤2：选择列 -->
  <view class="step-section" wx:if="{{currentStep === 2}}">
    <view class="step-header">
      <text class="step-title">步骤2：选择第几列</text>
      <text class="step-subtitle">当前项目：{{selectedProject.name}}</text>
    </view>

    <view class="column-list">
      <view
        class="column-item {{selectedColumn && selectedColumn.key === item.key ? 'selected' : ''}}"
        wx:for="{{projectColumns}}"
        wx:key="key"
        bindtap="selectColumn"
        data-column="{{item}}"
      >
        <view class="column-number">第{{index + 1}}列</view>
        <view class="column-info">
          <view class="column-name">{{item.name}}</view>
          <view class="column-current">当前内容：{{selectedProject[item.key] || '暂无'}}</view>
        </view>
        <view class="select-icon">{{selectedColumn && selectedColumn.key === item.key ? '✓' : '○'}}</view>
      </view>
    </view>

    <view class="button-group">
      <button class="next-btn" bindtap="nextStep" disabled="{{!selectedColumn}}">下一步</button>
      <button class="back-btn" bindtap="prevStep">上一步</button>
    </view>
  </view>

  <!-- 步骤3：选择操作类型 -->
  <view class="step-section" wx:if="{{currentStep === 3}}">
    <view class="step-header">
      <text class="step-title">步骤3：选择操作类型</text>
      <text class="step-subtitle">{{selectedProject.name}} - {{selectedColumn.name}}</text>
    </view>

    <!-- 项目进度列显示操作类型选择 -->
    <view wx:if="{{selectedColumn.key === 'progress'}}">
      <view class="action-list">
        <!-- 修改内容选项 -->
        <view
          class="action-item {{selectedAction === 'modify' ? 'selected' : ''}}"
          bindtap="selectAction"
          data-action="modify"
        >
          <view class="action-icon">✏️</view>
          <view class="action-info">
            <view class="action-name">修改内容</view>
            <view class="action-desc">修改项目进度信息</view>
          </view>
          <view class="select-icon">{{selectedAction === 'modify' ? '✓' : '○'}}</view>
        </view>

        <!-- 添加内容选项 -->
        <view
          class="action-item {{selectedAction === 'add' ? 'selected' : ''}}"
          bindtap="selectAction"
          data-action="add"
        >
          <view class="action-icon">📎</view>
          <view class="action-info">
            <view class="action-name">添加内容</view>
            <view class="action-desc">添加图片、视频、时间、地点、人员等</view>
          </view>
          <view class="select-icon">{{selectedAction === 'add' ? '✓' : '○'}}</view>
        </view>

        <!-- 删除内容选项 -->
        <view
          class="action-item {{selectedAction === 'delete' ? 'selected' : ''}}"
          bindtap="selectAction"
          data-action="delete"
        >
          <view class="action-icon">🗑️</view>
          <view class="action-info">
            <view class="action-name">删除内容</view>
            <view class="action-desc">删除项目进度记录</view>
          </view>
          <view class="select-icon">{{selectedAction === 'delete' ? '✓' : '○'}}</view>
        </view>
      </view>

      <view class="button-group">
        <button class="next-btn" bindtap="nextStep" disabled="{{!selectedAction}}">下一步</button>
        <button class="back-btn" bindtap="prevStep">上一步</button>
      </view>
    </view>

    <!-- 其他列直接显示修改界面 -->
    <view wx:else>
      <view class="direct-modify-notice">
        <view class="notice-icon">✏️</view>
        <text class="notice-text">您选择了{{selectedColumn.name}}列，将直接进入修改界面</text>
      </view>
      
      <view class="button-group">
        <button class="next-btn" bindtap="nextStep">进入修改界面</button>
        <button class="back-btn" bindtap="prevStep">上一步</button>
      </view>
    </view>
  </view>

  <!-- 步骤4：修改内容 -->
  <view class="step-section" wx:if="{{currentStep === 4 && (selectedAction === 'modify' || selectedColumn.key !== 'progress')}}">
    <view class="step-header">
      <text class="step-title">修改内容</text>
      <text class="step-subtitle">{{selectedProject.name}} - {{selectedColumn.name}}</text>
    </view>

    <!-- 项目进度列的修改界面 -->
    <view wx:if="{{selectedColumn.key === 'progress' && selectedAction === 'modify'}}">
      <!-- 时间筛选区域 -->
      <view class="modify-filter-section">
        <view class="filter-title-area">
          <view class="filter-icon">🕒</view>
          <text class="filter-main-title">时间筛选选择时间段查看进度记录</text>
        </view>

        <!-- 时间段按钮 -->
        <view class="time-filter-buttons">
          <view class="time-filter-item {{modifyTimeFilter === 'week' ? 'active' : ''}}" bindtap="filterModifyByTime" data-filter="week">
            <text class="filter-text">最近一周</text>
          </view>
          <view class="time-filter-item {{modifyTimeFilter === 'month' ? 'active' : ''}}" bindtap="filterModifyByTime" data-filter="month">
            <text class="filter-text">最近一月</text>
          </view>
          <view class="time-filter-item {{modifyTimeFilter === 'year' ? 'active' : ''}}" bindtap="filterModifyByTime" data-filter="year">
            <text class="filter-text">最近一年</text>
          </view>
          <view class="time-filter-item {{modifyTimeFilter === 'all' ? 'active' : ''}}" bindtap="filterModifyByTime" data-filter="all">
            <text class="filter-text">查看全部</text>
          </view>
        </view>

        <!-- 自定义日期选择 -->
        <view class="custom-date-area">
          <picker mode="date" value="{{selectedModifyDate}}" bindchange="onModifyDateChange">
            <view class="custom-date-picker">
              <view class="date-icon">📅</view>
              <text class="date-text">{{selectedModifyDate || '选择具体日期'}}</text>
              <view class="date-arrow">▼</view>
            </view>
          </picker>
        </view>
      </view>

      <!-- 统计信息卡片 -->
      <view class="modify-stats-area">
        <view class="stats-item">
          <text class="stats-num">{{filteredModifyProgressList.length}}</text>
          <text class="stats-desc">当前记录数</text>
        </view>
        <view class="stats-item">
          <text class="stats-num">{{selectedModifyRecord ? 1 : 0}}</text>
          <text class="stats-desc">已选择</text>
        </view>
      </view>

      <!-- 进度记录区域 -->
      <view class="modify-progress-area">
        <view class="progress-area-header">
          <view class="progress-icon">📋</view>
          <text class="progress-main-text">选择要修改的进度记录</text>
        </view>

        <!-- 空状态 -->
        <view class="modify-empty-state" wx:if="{{filteredModifyProgressList.length === 0}}">
          <view class="empty-icon-large">📝</view>
          <text class="empty-message">暂无符合条件的进度记录</text>
        </view>

        <!-- 进度记录列表 -->
        <view class="modify-progress-list" wx:else>
          <view
            class="modify-progress-item {{selectedModifyRecord && selectedModifyRecord.id === item.id ? 'item-selected' : ''}}"
            wx:for="{{filteredModifyProgressList}}"
            wx:key="id"
            bindtap="selectModifyRecord"
            data-record="{{item}}"
          >
            <view class="progress-checkbox">
              <view class="checkbox-icon">{{selectedModifyRecord && selectedModifyRecord.id === item.id ? '✓' : '○'}}</view>
            </view>

            <view class="progress-content">
              <view class="item-title">{{item.title || '进度记录'}}</view>
              <view class="item-details">
                <view class="detail-row">
                  <text class="detail-label">📅</text>
                  <text class="detail-value">{{item.date}}</text>
                </view>
                <view class="detail-row">
                  <text class="detail-label">👤</text>
                  <text class="detail-value">{{item.person || '未设置'}}</text>
                </view>
                <view class="detail-row">
                  <text class="detail-label">📍</text>
                  <text class="detail-value">{{item.location || '未设置'}}</text>
                </view>
              </view>
            </view>

            <view class="progress-status-area">
                        <view class="status-time-info">
            <text class="status-date">{{item.date}}</text>
          </view>
              <view class="status-badge {{item.status}}">{{item.statusText}}</view>
            </view>
          </view>
        </view>
      </view>

      <view class="button-group">
        <button class="next-btn" bindtap="nextStepToModifyDetail" disabled="{{!selectedModifyRecord}}">修改详情</button>
        <button class="back-btn" bindtap="prevStep">上一步</button>
      </view>
    </view>

    <!-- 其他列的修改界面 -->
    <view wx:if="{{selectedColumn.key !== 'progress'}}">
      <view class="simple-modify-content">
        <view class="current-value-section">
          <view class="section-title">
            <view class="title-icon">📝</view>
            <text class="title-text">当前内容</text>
          </view>
          <view class="current-value-display">
            <text class="current-value">{{currentColumnValue}}</text>
          </view>
        </view>

        <view class="new-value-section">
          <view class="section-title">
            <view class="title-icon">✏️</view>
            <text class="title-text">新内容</text>
          </view>

          <!-- 根据列类型显示不同的输入控件 -->
          <view wx:if="{{selectedColumn.type === 'textarea'}}">
            <textarea
              class="modify-textarea"
              placeholder="请输入新的{{selectedColumn.name}}"
              value="{{newContent}}"
              bindinput="onNewContentInput"
              maxlength="1000"
            ></textarea>
          </view>
          <view wx:elif="{{selectedColumn.key === 'startDate' || selectedColumn.key === 'endDate'}}">
            <picker mode="date" value="{{newContent}}" bindchange="onDatePickerChange">
              <view class="date-picker-display">
                <text class="date-text">{{newContent || '选择日期'}}</text>
                <view class="date-arrow">▼</view>
              </view>
            </picker>
          </view>
          <view wx:elif="{{selectedColumn.key === 'isKeyProject'}}">
            <view class="radio-group">
              <view class="radio-item {{newContent === '是' ? 'selected' : ''}}" bindtap="selectKeyProject" data-value="是">
                <view class="radio-icon">{{newContent === '是' ? '●' : '○'}}</view>
                <text class="radio-text">是</text>
              </view>
              <view class="radio-item {{newContent === '否' ? 'selected' : ''}}" bindtap="selectKeyProject" data-value="否">
                <view class="radio-icon">{{newContent === '否' ? '●' : '○'}}</view>
                <text class="radio-text">否</text>
              </view>
            </view>
          </view>
          <view wx:else>
            <input
              class="modify-input"
              placeholder="请输入新的{{selectedColumn.name}}"
              value="{{newContent}}"
              bindinput="onNewContentInput"
            />
          </view>
        </view>
      </view>

      <view class="button-group">
        <button class="next-btn" bindtap="confirmSimpleModify" disabled="{{!newContent}}">确认修改</button>
        <button class="back-btn" bindtap="prevStep">上一步</button>
      </view>
    </view>
  </view>

  <!-- 步骤5：修改详情 - 仅项目进度列 -->
  <view class="step-section" wx:if="{{currentStep === 5 && selectedAction === 'modify' && selectedColumn.key === 'progress'}}">
    <view class="step-header">
      <text class="step-title">修改详情</text>
      <text class="step-subtitle">{{selectedProject.name}} - {{selectedColumn.name}}</text>
    </view>

    <view class="modify-detail-content">
      <!-- 时间修改 -->
      <view class="modify-item">
        <view class="modify-label">
          <view class="label-icon">📅</view>
          <text class="label-text">时间</text>
        </view>
        <picker mode="date" value="{{modifyRecord.date}}" bindchange="onModifyDetailDateChange">
          <view class="modify-input-area">
            <text class="modify-input-text">{{modifyRecord.date || '选择日期'}}</text>
            <view class="input-arrow">▼</view>
          </view>
        </picker>
      </view>

      <!-- 人员修改 -->
      <view class="modify-item">
        <view class="modify-label">
          <view class="label-icon">👤</view>
          <text class="label-text">人员</text>
        </view>
        <input
          class="modify-input"
          placeholder="请输入人员信息"
          value="{{modifyRecord.person}}"
          bindinput="onModifyPersonInput"
        />
      </view>

      <!-- 地点修改 -->
      <view class="modify-item">
        <view class="modify-label">
          <view class="label-icon">📍</view>
          <text class="label-text">地点</text>
        </view>
        <input
          class="modify-input"
          placeholder="请输入地点信息"
          value="{{modifyRecord.location}}"
          bindinput="onModifyLocationInput"
        />
      </view>

      <!-- 图片修改 -->
      <view class="modify-item">
        <view class="modify-label">
          <view class="label-icon">🖼️</view>
          <text class="label-text">图片</text>
        </view>
        <view class="media-upload-area">
          <view class="current-media" wx:if="{{modifyRecord.images && modifyRecord.images.length > 0}}">
            <view class="media-item" wx:for="{{modifyRecord.images}}" wx:key="index">
              <image class="media-preview" src="{{item}}" mode="aspectFill"></image>
              <view class="media-remove" bindtap="removeModifyImage" data-index="{{index}}">×</view>
            </view>
          </view>
          <view class="upload-btn" bindtap="uploadModifyImage">
            <text class="upload-text">{{modifyRecord.images && modifyRecord.images.length > 0 ? '添加更多图片' : '上传图片'}}</text>
          </view>
        </view>
      </view>

      <!-- 视频修改 -->
      <view class="modify-item">
        <view class="modify-label">
          <view class="label-icon">🎥</view>
          <text class="label-text">视频</text>
        </view>
        <view class="media-upload-area">
          <view class="current-media" wx:if="{{modifyRecord.videos && modifyRecord.videos.length > 0}}">
            <view class="media-item" wx:for="{{modifyRecord.videos}}" wx:key="index">
              <video class="media-preview" src="{{item}}" controls></video>
              <view class="media-remove" bindtap="removeModifyVideo" data-index="{{index}}">×</view>
            </view>
          </view>
          <view class="upload-btn" bindtap="uploadModifyVideo">
            <text class="upload-text">{{modifyRecord.videos && modifyRecord.videos.length > 0 ? '添加更多视频' : '上传视频'}}</text>
          </view>
        </view>
      </view>

      <!-- 新闻稿文件上传 -->
      <view class="modify-item">
        <view class="modify-label">
          <view class="label-icon">📰</view>
          <text class="label-text">新闻稿文件</text>
        </view>

        <!-- 文件上传区域 -->
        <view class="file-upload-area">
          <view class="upload-btn" bindtap="uploadNewsFile">
            <view class="upload-icon">📄</view>
            <text class="upload-text">{{modifyRecord.newsFiles && modifyRecord.newsFiles.length > 0 ? '添加更多文件' : '上传新闻稿文件'}}</text>
            <text class="upload-desc">支持PDF、Word、图片格式</text>
          </view>

          <!-- 已上传文件列表 -->
          <view class="uploaded-files" wx:if="{{modifyRecord.newsFiles && modifyRecord.newsFiles.length > 0}}">
            <view class="file-item" wx:for="{{modifyRecord.newsFiles}}" wx:key="index">
              <view class="file-info">
                <view class="file-icon">📄</view>
                <view class="file-details">
                  <text class="file-name">{{item.name}}</text>
                  <text class="file-size">{{item.sizeText}}</text>
                </view>
              </view>
              <view class="file-actions">
                <text class="file-action preview" bindtap="previewFile" data-index="{{index}}">预览</text>
                <text class="file-action delete" bindtap="deleteNewsFile" data-index="{{index}}">删除</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <view class="button-group">
      <button class="save-btn" bindtap="saveModifyDetail">保存修改</button>
      <button class="back-btn" bindtap="backToModifyList">返回列表</button>
    </view>
  </view>

  <!-- 步骤4：添加内容 - 所有列都有，但内容不同 -->
  <view class="step-section" wx:if="{{currentStep === 4 && selectedAction === 'add'}}">
    <view class="step-header">
      <text class="step-title">添加内容</text>
      <text class="step-subtitle">{{selectedProject.name}} - {{selectedColumn.name}}</text>
    </view>

    <!-- 项目进度列的添加内容界面 -->
    <view wx:if="{{selectedColumn.key === 'progress'}}" class="add-content">
      <view class="upload-options">
        <view class="upload-item" bindtap="uploadImage">
          <view class="upload-icon">🖼️</view>
          <text class="upload-text">添加图片</text>
        </view>

        <view class="upload-item" bindtap="uploadVideo">
          <view class="upload-icon">🎥</view>
          <text class="upload-text">添加视频</text>
        </view>

        <view class="upload-item" bindtap="addTime">
          <view class="upload-icon">⏰</view>
          <text class="upload-text">添加时间</text>
        </view>

        <view class="upload-item" bindtap="addLocation">
          <view class="upload-icon">📍</view>
          <text class="upload-text">添加地点</text>
        </view>

        <view class="upload-item" bindtap="addPerson">
          <view class="upload-icon">👤</view>
          <text class="upload-text">添加人员</text>
        </view>

        <view class="upload-item" bindtap="uploadDocument">
          <view class="upload-icon">📄</view>
          <text class="upload-text">添加新闻稿</text>
        </view>
      </view>

      <!-- 项目进度列的输入界面 -->
      <view class="progress-add-inputs">
        <!-- 时间输入框 -->
        <view class="input-section" wx:if="{{showTimeInput}}">
          <text class="input-label">添加时间</text>
          <picker
            mode="date"
            value="{{selectedDate}}"
            bindchange="onDateChange"
            class="form-input"
          >
            <view class="picker-text">{{selectedDate || '请选择日期'}}</view>
          </picker>
          
          <button class="add-btn" bindtap="confirmAddTime">添加时间</button>
        </view>

        <!-- 地点输入框 -->
        <view class="input-section" wx:if="{{showLocationInput}}">
          <text class="input-label">添加地点</text>
          <input
            class="form-input"
            placeholder="请输入地点名称"
            value="{{locationName}}"
            bindinput="onLocationInput"
          />
          <button class="add-btn" bindtap="confirmAddLocation">添加地点</button>
        </view>

        <!-- 人员输入框 -->
        <view class="input-section" wx:if="{{showPersonInput}}">
          <text class="input-label">添加人员</text>
          <input
            class="form-input"
            placeholder="请输入人员姓名"
            value="{{personName}}"
            bindinput="onPersonNameInput"
          />
          <button class="add-btn" bindtap="confirmAddPerson">添加人员</button>
        </view>

        <!-- 已添加的内容列表 -->
        <view class="added-content" wx:if="{{addedItems.length > 0}}">
          <text class="content-label">已添加的内容：</text>
          <view
            class="added-item"
            wx:for="{{addedItems}}"
            wx:key="index"
          >
            <text class="item-type">{{item.type}}</text>
            <text class="item-name">{{item.name}}</text>
            <view class="item-actions">
              <button class="remove-btn" bindtap="removeItem" data-index="{{index}}">删除</button>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 其他列的添加内容界面 -->
    <view wx:else class="add-content-simple">
      <!-- 联系人信息列 -->
      <view wx:if="{{selectedColumn.key === 'contacts'}}" class="simple-add-section">
        <view class="add-input-area">
          <text class="input-label">添加联系人信息</text>
          <input
            class="form-input"
            placeholder="格式：姓名:电话号码"
            value="{{newContent}}"
            bindinput="onNewContentInput"
          />
          <view class="input-hint">例如：张三:13800138000</view>
        </view>
      </view>

      <!-- 涉及典型县镇村列 -->
      <view wx:elif="{{selectedColumn.key === 'involvedAreas'}}" class="simple-add-section">
        <view class="add-input-area">
          <text class="input-label">添加涉及区域</text>
          <input
            class="form-input"
            placeholder="请输入县/镇/村信息"
            value="{{newContent}}"
            bindinput="onNewContentInput"
          />
          <view class="input-hint">例如：临安区青山湖街道</view>
        </view>
      </view>

      <!-- 多行文本类型列 -->
      <view wx:elif="{{selectedColumn.type === 'textarea'}}" class="simple-add-section">
        <view class="add-input-area">
          <text class="input-label">添加{{selectedColumn.name}}</text>
          <textarea
            class="form-textarea"
            placeholder="请输入要添加的内容"
            value="{{newContent}}"
            bindinput="onNewContentInput"
            maxlength="500"
          ></textarea>
          <view class="input-hint">最多500字符</view>
        </view>
      </view>

      <!-- 其他文本类型列 -->
      <view wx:else class="simple-add-section">
        <view class="add-input-area">
          <text class="input-label">添加{{selectedColumn.name}}</text>
          <input
            class="form-input"
            placeholder="请输入要添加的{{selectedColumn.name}}"
            value="{{newContent}}"
            bindinput="onNewContentInput"
          />
        </view>
      </view>
    </view>

    <view class="button-group">
      <!-- 项目进度列使用原有的保存逻辑 -->
      <button
        wx:if="{{selectedColumn.key === 'progress'}}"
        class="save-btn"
        bindtap="saveAddition"
        disabled="{{addedItems.length === 0}}"
      >保存添加</button>

      <!-- 其他列使用简单的保存逻辑 -->
      <button
        wx:else
        class="save-btn"
        bindtap="saveSimpleAddition"
        disabled="{{!newContent.trim()}}"
      >保存添加</button>

      <button class="back-btn" bindtap="prevStep">上一步</button>
    </view>
  </view>

  <!-- 步骤4：删除内容 - 仅项目进度列 -->
  <view class="step-section" wx:if="{{currentStep === 4 && selectedAction === 'delete' && selectedColumn.key === 'progress'}}">
    <view class="step-header">
      <text class="step-title">删除内容</text>
      <text class="step-subtitle">{{selectedProject.name}} - {{selectedColumn.name}}</text>
    </view>

    <!-- 时间筛选区域 -->
    <view class="delete-filter-section">
      <view class="filter-title-area">
        <view class="filter-icon">🕒</view>
        <text class="filter-main-title">时间筛选选择时间段查看进度记录</text>
      </view>

      <!-- 时间段按钮 -->
      <view class="time-filter-buttons">
        <view class="time-filter-item {{timeFilter === 'week' ? 'active' : ''}}" bindtap="filterByTime" data-filter="week">
          <text class="filter-text">最近一周</text>
        </view>
        <view class="time-filter-item {{timeFilter === 'month' ? 'active' : ''}}" bindtap="filterByTime" data-filter="month">
          <text class="filter-text">最近一月</text>
        </view>
        <view class="time-filter-item {{timeFilter === 'year' ? 'active' : ''}}" bindtap="filterByTime" data-filter="year">
          <text class="filter-text">最近一年</text>
        </view>
        <view class="time-filter-item {{timeFilter === 'all' ? 'active' : ''}}" bindtap="filterByTime" data-filter="all">
          <text class="filter-text">查看全部</text>
        </view>
      </view>

      <!-- 自定义日期选择 -->
      <view class="custom-date-area">
        <picker mode="date" value="{{selectedDeleteDate}}" bindchange="onDeleteDateChange">
          <view class="custom-date-picker">
            <view class="date-icon">📅</view>
            <text class="date-text">{{selectedDeleteDate || '选择具体日期'}}</text>
            <view class="date-arrow">▼</view>
          </view>
        </picker>
      </view>
    </view>

    <!-- 统计信息卡片 -->
    <view class="delete-stats-area">
      <view class="stats-item">
        <text class="stats-num">{{filteredProgressList.length}}</text>
        <text class="stats-desc">当前记录数</text>
      </view>
      <view class="stats-item">
        <text class="stats-num">{{selectedDeleteCount}}</text>
        <text class="stats-desc">已选择</text>
      </view>
    </view>

    <!-- 批量操作按钮 -->
    <view class="batch-operation-area" wx:if="{{selectedDeleteCount > 0}}">
      <view class="batch-select-btn" bindtap="selectAllProgress">
        <text class="batch-text">{{isAllProgressSelected ? '取消全选' : '全选'}}</text>
      </view>
      <view class="batch-delete-btn" bindtap="batchDeleteProgress">
        <text class="batch-text">批量删除 ({{selectedDeleteCount}})</text>
      </view>
    </view>

    <!-- 进度记录区域 -->
    <view class="delete-progress-area">
      <view class="progress-area-header">
        <view class="progress-icon">📋</view>
        <view class="progress-header-text">
          <text class="progress-main-text">进度记录点击选择要删除的记录</text>
        </view>
      </view>

      <!-- 空状态 -->
      <view class="delete-empty-state" wx:if="{{filteredProgressList.length === 0}}">
        <view class="empty-icon-large">📭</view>
        <text class="empty-message">暂无符合条件的进度记录</text>
      </view>

      <!-- 进度记录列表 -->
      <view class="delete-progress-list" wx:if="{{filteredProgressList.length > 0}}">
        <view
          class="delete-progress-item {{item.selected ? 'item-selected' : ''}}"
          wx:for="{{filteredProgressList}}"
          wx:key="id"
          bindtap="toggleProgressSelect"
          data-id="{{item.id}}"
        >
          <!-- 选择框 -->
          <view class="item-checkbox {{item.selected ? 'checkbox-checked' : ''}}">
            <text class="checkbox-icon">{{item.selected ? '✓' : ''}}</text>
          </view>

          <!-- 进度信息 -->
          <view class="item-content">
            <text class="item-title">{{item.title}}</text>

            <view class="item-details">
              <view class="detail-row">
                <text class="detail-label">📅</text>
                <text class="detail-value">{{item.date}}</text>
              </view>
              <view class="detail-row">
                <text class="detail-label">👤</text>
                <text class="detail-value">{{item.person}}</text>
              </view>
              <view class="detail-row">
                <text class="detail-label">📍</text>
                <text class="detail-value">{{item.location}}</text>
              </view>
            </view>
          </view>

          <!-- 状态区域 -->
          <view class="delete-status-area">
            <view class="status-time-info">
              <text class="status-date">{{item.date}}</text>
            </view>
            <view class="status-badge {{item.status}}">{{item.statusText}}</view>
          </view>

          <!-- 删除按钮 -->
          <view class="item-delete-btn" bindtap="singleDeleteProgress" data-id="{{item.id}}" catchtap="singleDeleteProgress">
            <text class="delete-btn-icon">🗑️</text>
          </view>
        </view>
      </view>
    </view>

    <view class="button-group">
      <button class="back-btn" bindtap="prevStep">上一步</button>
    </view>
  </view>
</view>