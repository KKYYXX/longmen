<view class="modify-container">
  <view class="page-header">
    <text class="page-title">åˆ æ”¹é¡¹ç›®</text>
    <text class="page-subtitle">é€‰æ‹©é¡¹ç›®å’Œåˆ—è¿›è¡Œä¿®æ”¹æˆ–æ·»åŠ å†…å®¹</text>
  </view>

  <!-- æ­¥éª¤1ï¼šé€‰æ‹©é¡¹ç›® -->
  <view class="step-section" wx:if="{{currentStep === 1}}">
    <view class="step-header">
      <text class="step-title">æ­¥éª¤1ï¼šé€‰æ‹©ç¬¬å‡ ä¸ªé¡¹ç›®</text>
    </view>
    
    <!-- é¡¹ç›®æ•°é‡ä¿¡æ¯ -->
    <view class="project-count-info" wx:if="{{!loading && projectList.length > 0}}">
      <text class="count-text">å…±æ‰¾åˆ° {{projectList.length}} ä¸ªé¡¹ç›®</text>
    </view>
    
    <!-- æœç´¢æ¡† -->
    <view class="search-section" wx:if="{{!loading && projectList.length > 0}}">
      <view class="search-box">
        <text class="search-icon">ğŸ”</text>
        <input class="search-input"
               placeholder="æœç´¢é¡¹ç›®åç§°..."
               value="{{searchKeyword}}"
               bindinput="onSearchInput"
               bindconfirm="onSearch"/>
        <view class="search-actions">
          <text class="clear-search-btn" bindtap="clearSearch" wx:if="{{searchKeyword}}">âœ•</text>
          <text class="search-btn" bindtap="onSearch">æœç´¢</text>
        </view>
      </view>
      
      <!-- æœç´¢ç»“æœä¿¡æ¯ -->
      <view class="search-result-info" wx:if="{{searchKeyword && filteredProjectList.length > 0}}">
        <text class="result-text">æ‰¾åˆ° {{filteredProjectList.length}} ä¸ªåŒ¹é…é¡¹ç›®</text>
      </view>
    </view>

    <view class="project-list">
      <!-- åŠ è½½çŠ¶æ€æ˜¾ç¤º -->
      <view class="loading-state" wx:if="{{loading}}">
        <text class="loading-icon">â³</text>
        <text class="loading-text">æ­£åœ¨åŠ è½½é¡¹ç›®åˆ—è¡¨...</text>
      </view>
      
      <!-- é¡¹ç›®åˆ—è¡¨ - æ”¯æŒæœç´¢è¿‡æ»¤ -->
      <view
        class="project-item {{selectedProject && selectedProject.id === item.id ? 'selected' : ''}}"
        wx:for="{{searchKeyword ? filteredProjectList : projectList}}"
        wx:key="id"
        bindtap="selectProject"
        data-project="{{item}}"
        wx:if="{{!loading}}"
      >
        <view class="project-number">ç¬¬{{index + 1}}ä¸ª</view>
        <view class="project-info">
          <view class="project-name">{{item.name}}</view>
          <view class="project-desc">{{item.description}}</view>
          <view class="project-meta">
            <text class="meta-item">ID: {{item.id}}</text>
          </view>
        </view>
        <view class="select-icon">{{selectedProject && selectedProject.id === item.id ? 'âœ“' : 'â—‹'}}</view>
      </view>
      
      <!-- ç©ºçŠ¶æ€æ˜¾ç¤º -->
      <view class="empty-state" wx:if="{{projectList.length === 0 && !loading}}">
        <text class="empty-icon">ğŸ—ï¸</text>
        <text class="empty-text">æš‚æ— é¡¹ç›®æ•°æ®</text>
        <text class="empty-desc">è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–è”ç³»ç®¡ç†å‘˜</text>
        <view class="retry-btn" bindtap="loadProjectList">
          <text class="retry-icon">ğŸ”„</text>
          <text class="retry-text">é‡æ–°åŠ è½½</text>
        </view>
      </view>
      
      <!-- æœç´¢æ— ç»“æœæç¤º -->
      <view class="search-no-result" wx:if="{{searchKeyword && filteredProjectList.length === 0 && !loading}}">
        <text class="no-result-icon">ğŸ”</text>
        <text class="no-result-text">æœªæ‰¾åˆ°åŒ¹é…çš„é¡¹ç›®</text>
        <text class="no-result-desc">è¯·å°è¯•å…¶ä»–å…³é”®è¯</text>
        <view class="clear-search-btn-large" bindtap="clearSearch">
          <text class="clear-text">æ¸…é™¤æœç´¢</text>
        </view>
      </view>
    </view>

    <view class="button-group">
      <button class="next-btn" bindtap="nextStep" disabled="{{!selectedProject}}">ä¸‹ä¸€æ­¥</button>
      <button class="cancel-btn" bindtap="cancel">å–æ¶ˆ</button>
    </view>
  </view>

  <!-- æ­¥éª¤2ï¼šé€‰æ‹©åˆ— -->
  <view class="step-section" wx:if="{{currentStep === 2}}">
    <view class="step-header">
      <text class="step-title">æ­¥éª¤2ï¼šé€‰æ‹©ç¬¬å‡ åˆ—</text>
      <text class="step-subtitle">å½“å‰é¡¹ç›®ï¼š{{selectedProject.name}}</text>
    </view>

    <view class="column-list">
      <view
        class="column-item {{selectedColumn && selectedColumn.key === item.key ? 'selected' : ''}}"
        wx:for="{{projectColumns}}"
        wx:key="key"
        bindtap="selectColumn"
        data-column="{{item}}"
      >
        <view class="column-number">ç¬¬{{index + 1}}åˆ—</view>
        <view class="column-info">
          <view class="column-name">{{item.name}}</view>
          <view class="column-current">å½“å‰å†…å®¹ï¼š{{selectedProject[item.key] || 'æš‚æ— '}}</view>
        </view>
        <view class="select-icon">{{selectedColumn && selectedColumn.key === item.key ? 'âœ“' : 'â—‹'}}</view>
      </view>
    </view>

    <view class="button-group">
      <button class="next-btn" bindtap="nextStep" disabled="{{!selectedColumn}}">ä¸‹ä¸€æ­¥</button>
      <button class="back-btn" bindtap="prevStep">ä¸Šä¸€æ­¥</button>
    </view>
  </view>

  <!-- æ­¥éª¤3ï¼šé€‰æ‹©æ“ä½œç±»å‹ -->
  <view class="step-section" wx:if="{{currentStep === 3}}">
    <view class="step-header">
      <text class="step-title">æ­¥éª¤3ï¼šé€‰æ‹©æ“ä½œç±»å‹</text>
      <text class="step-subtitle">{{selectedProject.name}} - {{selectedColumn.name}}</text>
    </view>

    <!-- é¡¹ç›®è¿›åº¦åˆ—æ˜¾ç¤ºæ“ä½œç±»å‹é€‰æ‹© -->
    <view wx:if="{{selectedColumn.key === 'progress'}}">
      <view class="action-list">
        <!-- ä¿®æ”¹å†…å®¹é€‰é¡¹ -->
        <view
          class="action-item {{selectedAction === 'modify' ? 'selected' : ''}}"
          bindtap="selectAction"
          data-action="modify"
        >
          <view class="action-icon">âœï¸</view>
          <view class="action-info">
            <view class="action-name">ä¿®æ”¹å†…å®¹</view>
            <view class="action-desc">ä¿®æ”¹é¡¹ç›®è¿›åº¦ä¿¡æ¯</view>
          </view>
          <view class="select-icon">{{selectedAction === 'modify' ? 'âœ“' : 'â—‹'}}</view>
        </view>

        <!-- æ·»åŠ å†…å®¹é€‰é¡¹ -->
        <view
          class="action-item {{selectedAction === 'add' ? 'selected' : ''}}"
          bindtap="selectAction"
          data-action="add"
        >
          <view class="action-icon">ğŸ“</view>
          <view class="action-info">
            <view class="action-name">æ·»åŠ å†…å®¹</view>
            <view class="action-desc">æ·»åŠ å›¾ç‰‡ã€è§†é¢‘ã€æ—¶é—´ã€åœ°ç‚¹ã€äººå‘˜ç­‰</view>
          </view>
          <view class="select-icon">{{selectedAction === 'add' ? 'âœ“' : 'â—‹'}}</view>
        </view>

        <!-- åˆ é™¤å†…å®¹é€‰é¡¹ -->
        <view
          class="action-item {{selectedAction === 'delete' ? 'selected' : ''}}"
          bindtap="selectAction"
          data-action="delete"
        >
          <view class="action-icon">ğŸ—‘ï¸</view>
          <view class="action-info">
            <view class="action-name">åˆ é™¤å†…å®¹</view>
            <view class="action-desc">åˆ é™¤é¡¹ç›®è¿›åº¦è®°å½•</view>
          </view>
          <view class="select-icon">{{selectedAction === 'delete' ? 'âœ“' : 'â—‹'}}</view>
        </view>
      </view>

      <view class="button-group">
        <button class="next-btn" bindtap="nextStep" disabled="{{!selectedAction}}">ä¸‹ä¸€æ­¥</button>
        <button class="back-btn" bindtap="prevStep">ä¸Šä¸€æ­¥</button>
      </view>
    </view>

    <!-- å…¶ä»–åˆ—ç›´æ¥æ˜¾ç¤ºä¿®æ”¹ç•Œé¢ -->
    <view wx:else>
      <view class="direct-modify-notice">
        <view class="notice-icon">âœï¸</view>
        <text class="notice-text">æ‚¨é€‰æ‹©äº†{{selectedColumn.name}}åˆ—ï¼Œå°†ç›´æ¥è¿›å…¥ä¿®æ”¹ç•Œé¢</text>
      </view>
      
      <view class="button-group">
        <button class="next-btn" bindtap="nextStep">è¿›å…¥ä¿®æ”¹ç•Œé¢</button>
        <button class="back-btn" bindtap="prevStep">ä¸Šä¸€æ­¥</button>
      </view>
    </view>
  </view>

  <!-- æ­¥éª¤4ï¼šä¿®æ”¹å†…å®¹ -->
  <view class="step-section" wx:if="{{currentStep === 4 && (selectedAction === 'modify' || selectedColumn.key !== 'progress')}}">
    <view class="step-header">
      <text class="step-title">ä¿®æ”¹å†…å®¹</text>
      <text class="step-subtitle">{{selectedProject.name}} - {{selectedColumn.name}}</text>
    </view>

    <!-- é¡¹ç›®è¿›åº¦åˆ—çš„ä¿®æ”¹ç•Œé¢ -->
    <view wx:if="{{selectedColumn.key === 'progress' && selectedAction === 'modify'}}">
      <!-- æ—¶é—´ç­›é€‰åŒºåŸŸ -->
      <view class="modify-filter-section">
        <view class="filter-title-area">
          <view class="filter-icon">ğŸ•’</view>
          <text class="filter-main-title">æ—¶é—´ç­›é€‰é€‰æ‹©æ—¶é—´æ®µæŸ¥çœ‹è¿›åº¦è®°å½•</text>
        </view>

        <!-- æ—¶é—´æ®µæŒ‰é’® -->
        <view class="time-filter-buttons">
          <view class="time-filter-item {{modifyTimeFilter === 'week' ? 'active' : ''}}" bindtap="filterModifyByTime" data-filter="week">
            <text class="filter-text">æœ€è¿‘ä¸€å‘¨</text>
          </view>
          <view class="time-filter-item {{modifyTimeFilter === 'month' ? 'active' : ''}}" bindtap="filterModifyByTime" data-filter="month">
            <text class="filter-text">æœ€è¿‘ä¸€æœˆ</text>
          </view>
          <view class="time-filter-item {{modifyTimeFilter === 'year' ? 'active' : ''}}" bindtap="filterModifyByTime" data-filter="year">
            <text class="filter-text">æœ€è¿‘ä¸€å¹´</text>
          </view>
          <view class="time-filter-item {{modifyTimeFilter === 'all' ? 'active' : ''}}" bindtap="filterModifyByTime" data-filter="all">
            <text class="filter-text">æŸ¥çœ‹å…¨éƒ¨</text>
          </view>
        </view>

        <!-- è‡ªå®šä¹‰æ—¥æœŸé€‰æ‹© -->
        <view class="custom-date-area">
          <picker mode="date" value="{{selectedModifyDate}}" bindchange="onModifyDateChange">
            <view class="custom-date-picker">
              <view class="date-icon">ğŸ“…</view>
              <text class="date-text">{{selectedModifyDate || 'é€‰æ‹©å…·ä½“æ—¥æœŸ'}}</text>
              <view class="date-arrow">â–¼</view>
            </view>
          </picker>
        </view>
      </view>

      <!-- ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡ -->
      <view class="modify-stats-area">
        <view class="stats-item">
          <text class="stats-num">{{filteredModifyProgressList.length}}</text>
          <text class="stats-desc">å½“å‰è®°å½•æ•°</text>
        </view>
        <view class="stats-item">
          <text class="stats-num">{{selectedModifyRecord ? 1 : 0}}</text>
          <text class="stats-desc">å·²é€‰æ‹©</text>
        </view>
      </view>

      <!-- è¿›åº¦è®°å½•åŒºåŸŸ -->
      <view class="modify-progress-area">
        <view class="progress-area-header">
          <view class="progress-icon">ğŸ“‹</view>
          <text class="progress-main-text">é€‰æ‹©è¦ä¿®æ”¹çš„è¿›åº¦è®°å½•</text>
        </view>

        <!-- ç©ºçŠ¶æ€ -->
        <view class="modify-empty-state" wx:if="{{filteredModifyProgressList.length === 0}}">
          <view class="empty-icon-large">ğŸ“</view>
          <text class="empty-message">æš‚æ— ç¬¦åˆæ¡ä»¶çš„è¿›åº¦è®°å½•</text>
        </view>

        <!-- è¿›åº¦è®°å½•åˆ—è¡¨ -->
        <view class="modify-progress-list" wx:else>
          <view
            class="modify-progress-item {{selectedModifyRecord && selectedModifyRecord.id === item.id ? 'item-selected' : ''}}"
            wx:for="{{filteredModifyProgressList}}"
            wx:key="id"
            bindtap="selectModifyRecord"
            data-record="{{item}}"
          >
            <view class="progress-checkbox">
              <view class="checkbox-icon">{{selectedModifyRecord && selectedModifyRecord.id === item.id ? 'âœ“' : 'â—‹'}}</view>
            </view>

            <view class="progress-content">
              <view class="item-title">{{item.title || 'è¿›åº¦è®°å½•'}}</view>
              <view class="item-details">
                <view class="detail-row">
                  <text class="detail-label">ğŸ“…</text>
                  <text class="detail-value">{{item.date}}</text>
                </view>
                <view class="detail-row">
                  <text class="detail-label">ğŸ‘¤</text>
                  <text class="detail-value">{{item.person || 'æœªè®¾ç½®'}}</text>
                </view>
                <view class="detail-row">
                  <text class="detail-label">ğŸ“</text>
                  <text class="detail-value">{{item.location || 'æœªè®¾ç½®'}}</text>
                </view>
              </view>
            </view>

            <view class="progress-status-area">
                        <view class="status-time-info">
            <text class="status-date">{{item.date}}</text>
          </view>
              <view class="status-badge {{item.status}}">{{item.statusText}}</view>
            </view>
          </view>
        </view>
      </view>

      <view class="button-group">
        <button class="next-btn" bindtap="nextStepToModifyDetail" disabled="{{!selectedModifyRecord}}">ä¿®æ”¹è¯¦æƒ…</button>
        <button class="back-btn" bindtap="prevStep">ä¸Šä¸€æ­¥</button>
      </view>
    </view>

    <!-- å…¶ä»–åˆ—çš„ä¿®æ”¹ç•Œé¢ -->
    <view wx:if="{{selectedColumn.key !== 'progress'}}">
      <view class="simple-modify-content">
        <view class="current-value-section">
          <view class="section-title">
            <view class="title-icon">ğŸ“</view>
            <text class="title-text">å½“å‰å†…å®¹</text>
          </view>
          <view class="current-value-display">
            <text class="current-value">{{currentColumnValue}}</text>
          </view>
        </view>

        <view class="new-value-section">
          <view class="section-title">
            <view class="title-icon">âœï¸</view>
            <text class="title-text">æ–°å†…å®¹</text>
          </view>

          <!-- æ ¹æ®åˆ—ç±»å‹æ˜¾ç¤ºä¸åŒçš„è¾“å…¥æ§ä»¶ -->
          <view wx:if="{{selectedColumn.type === 'textarea'}}">
            <textarea
              class="modify-textarea"
              placeholder="è¯·è¾“å…¥æ–°çš„{{selectedColumn.name}}"
              value="{{newContent}}"
              bindinput="onNewContentInput"
              maxlength="1000"
            ></textarea>
          </view>
          <view wx:elif="{{selectedColumn.key === 'startDate' || selectedColumn.key === 'endDate'}}">
            <picker mode="date" value="{{newContent}}" bindchange="onDatePickerChange">
              <view class="date-picker-display">
                <text class="date-text">{{newContent || 'é€‰æ‹©æ—¥æœŸ'}}</text>
                <view class="date-arrow">â–¼</view>
              </view>
            </picker>
          </view>
          <view wx:elif="{{selectedColumn.key === 'isKeyProject'}}">
            <view class="radio-group">
              <view class="radio-item {{newContent === 'æ˜¯' ? 'selected' : ''}}" bindtap="selectKeyProject" data-value="æ˜¯">
                <view class="radio-icon">{{newContent === 'æ˜¯' ? 'â—' : 'â—‹'}}</view>
                <text class="radio-text">æ˜¯</text>
              </view>
              <view class="radio-item {{newContent === 'å¦' ? 'selected' : ''}}" bindtap="selectKeyProject" data-value="å¦">
                <view class="radio-icon">{{newContent === 'å¦' ? 'â—' : 'â—‹'}}</view>
                <text class="radio-text">å¦</text>
              </view>
            </view>
          </view>
          <view wx:else>
            <input
              class="modify-input"
              placeholder="è¯·è¾“å…¥æ–°çš„{{selectedColumn.name}}"
              value="{{newContent}}"
              bindinput="onNewContentInput"
            />
          </view>
        </view>
      </view>

      <view class="button-group">
        <button class="next-btn" bindtap="confirmSimpleModify" disabled="{{!newContent}}">ç¡®è®¤ä¿®æ”¹</button>
        <button class="back-btn" bindtap="prevStep">ä¸Šä¸€æ­¥</button>
      </view>
    </view>
  </view>

  <!-- æ­¥éª¤5ï¼šä¿®æ”¹è¯¦æƒ… - ä»…é¡¹ç›®è¿›åº¦åˆ— -->
  <view class="step-section" wx:if="{{currentStep === 5 && selectedAction === 'modify' && selectedColumn.key === 'progress'}}">
    <view class="step-header">
      <text class="step-title">ä¿®æ”¹è¯¦æƒ…</text>
      <text class="step-subtitle">{{selectedProject.name}} - {{selectedColumn.name}}</text>
    </view>

    <view class="modify-detail-content">
      <!-- æ—¶é—´ä¿®æ”¹ -->
      <view class="modify-item">
        <view class="modify-label">
          <view class="label-icon">ğŸ“…</view>
          <text class="label-text">æ—¶é—´</text>
        </view>
        <picker mode="date" value="{{modifyRecord.date}}" bindchange="onModifyDetailDateChange">
          <view class="modify-input-area">
            <text class="modify-input-text">{{modifyRecord.date || 'é€‰æ‹©æ—¥æœŸ'}}</text>
            <view class="input-arrow">â–¼</view>
          </view>
        </picker>
      </view>

      <!-- äººå‘˜ä¿®æ”¹ -->
      <view class="modify-item">
        <view class="modify-label">
          <view class="label-icon">ğŸ‘¤</view>
          <text class="label-text">äººå‘˜</text>
        </view>
        <input
          class="modify-input"
          placeholder="è¯·è¾“å…¥äººå‘˜ä¿¡æ¯"
          value="{{modifyRecord.person}}"
          bindinput="onModifyPersonInput"
        />
      </view>

      <!-- åœ°ç‚¹ä¿®æ”¹ -->
      <view class="modify-item">
        <view class="modify-label">
          <view class="label-icon">ğŸ“</view>
          <text class="label-text">åœ°ç‚¹</text>
        </view>
        <input
          class="modify-input"
          placeholder="è¯·è¾“å…¥åœ°ç‚¹ä¿¡æ¯"
          value="{{modifyRecord.location}}"
          bindinput="onModifyLocationInput"
        />
      </view>

      <!-- å›¾ç‰‡ä¿®æ”¹ -->
      <view class="modify-item">
        <view class="modify-label">
          <view class="label-icon">ğŸ–¼ï¸</view>
          <text class="label-text">å›¾ç‰‡</text>
        </view>
        <view class="media-upload-area">
          <view class="current-media" wx:if="{{modifyRecord.images && modifyRecord.images.length > 0}}">
            <view class="media-item" wx:for="{{modifyRecord.images}}" wx:key="index">
              <image class="media-preview" src="{{item}}" mode="aspectFill"></image>
              <view class="media-remove" bindtap="removeModifyImage" data-index="{{index}}">Ã—</view>
            </view>
          </view>
          <view class="upload-btn" bindtap="uploadModifyImage">
            <text class="upload-text">{{modifyRecord.images && modifyRecord.images.length > 0 ? 'æ·»åŠ æ›´å¤šå›¾ç‰‡' : 'ä¸Šä¼ å›¾ç‰‡'}}</text>
          </view>
        </view>
      </view>

      <!-- è§†é¢‘ä¿®æ”¹ -->
      <view class="modify-item">
        <view class="modify-label">
          <view class="label-icon">ğŸ¥</view>
          <text class="label-text">è§†é¢‘</text>
        </view>
        <view class="media-upload-area">
          <view class="current-media" wx:if="{{modifyRecord.videos && modifyRecord.videos.length > 0}}">
            <view class="media-item" wx:for="{{modifyRecord.videos}}" wx:key="index">
              <video class="media-preview" src="{{item}}" controls></video>
              <view class="media-remove" bindtap="removeModifyVideo" data-index="{{index}}">Ã—</view>
            </view>
          </view>
          <view class="upload-btn" bindtap="uploadModifyVideo">
            <text class="upload-text">{{modifyRecord.videos && modifyRecord.videos.length > 0 ? 'æ·»åŠ æ›´å¤šè§†é¢‘' : 'ä¸Šä¼ è§†é¢‘'}}</text>
          </view>
        </view>
      </view>

      <!-- æ–°é—»ç¨¿æ–‡ä»¶ä¸Šä¼  -->
      <view class="modify-item">
        <view class="modify-label">
          <view class="label-icon">ğŸ“°</view>
          <text class="label-text">æ–°é—»ç¨¿æ–‡ä»¶</text>
        </view>

        <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
        <view class="file-upload-area">
          <view class="upload-btn" bindtap="uploadNewsFile">
            <view class="upload-icon">ğŸ“„</view>
            <text class="upload-text">{{modifyRecord.newsFiles && modifyRecord.newsFiles.length > 0 ? 'æ·»åŠ æ›´å¤šæ–‡ä»¶' : 'ä¸Šä¼ æ–°é—»ç¨¿æ–‡ä»¶'}}</text>
            <text class="upload-desc">æ”¯æŒPDFã€Wordã€å›¾ç‰‡æ ¼å¼</text>
          </view>

          <!-- å·²ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨ -->
          <view class="uploaded-files" wx:if="{{modifyRecord.newsFiles && modifyRecord.newsFiles.length > 0}}">
            <view class="file-item" wx:for="{{modifyRecord.newsFiles}}" wx:key="index">
              <view class="file-info">
                <view class="file-icon">ğŸ“„</view>
                <view class="file-details">
                  <text class="file-name">{{item.name}}</text>
                  <text class="file-size">{{item.sizeText}}</text>
                </view>
              </view>
              <view class="file-actions">
                <text class="file-action preview" bindtap="previewFile" data-index="{{index}}">é¢„è§ˆ</text>
                <text class="file-action delete" bindtap="deleteNewsFile" data-index="{{index}}">åˆ é™¤</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <view class="button-group">
      <button class="save-btn" bindtap="saveModifyDetail">ä¿å­˜ä¿®æ”¹</button>
      <button class="back-btn" bindtap="backToModifyList">è¿”å›åˆ—è¡¨</button>
    </view>
  </view>

  <!-- æ­¥éª¤4ï¼šæ·»åŠ å†…å®¹ - æ‰€æœ‰åˆ—éƒ½æœ‰ï¼Œä½†å†…å®¹ä¸åŒ -->
  <view class="step-section" wx:if="{{currentStep === 4 && selectedAction === 'add'}}">
    <view class="step-header">
      <text class="step-title">æ·»åŠ å†…å®¹</text>
      <text class="step-subtitle">{{selectedProject.name}} - {{selectedColumn.name}}</text>
    </view>

    <!-- é¡¹ç›®è¿›åº¦åˆ—çš„æ·»åŠ å†…å®¹ç•Œé¢ -->
    <view wx:if="{{selectedColumn.key === 'progress'}}" class="add-content">
      <view class="upload-options">
        <view class="upload-item" bindtap="uploadImage">
          <view class="upload-icon">ğŸ–¼ï¸</view>
          <text class="upload-text">æ·»åŠ å›¾ç‰‡</text>
        </view>

        <view class="upload-item" bindtap="uploadVideo">
          <view class="upload-icon">ğŸ¥</view>
          <text class="upload-text">æ·»åŠ è§†é¢‘</text>
        </view>

        <view class="upload-item" bindtap="addTime">
          <view class="upload-icon">â°</view>
          <text class="upload-text">æ·»åŠ æ—¶é—´</text>
        </view>

        <view class="upload-item" bindtap="addLocation">
          <view class="upload-icon">ğŸ“</view>
          <text class="upload-text">æ·»åŠ åœ°ç‚¹</text>
        </view>

        <view class="upload-item" bindtap="addPerson">
          <view class="upload-icon">ğŸ‘¤</view>
          <text class="upload-text">æ·»åŠ äººå‘˜</text>
        </view>

        <view class="upload-item" bindtap="uploadDocument">
          <view class="upload-icon">ğŸ“„</view>
          <text class="upload-text">æ·»åŠ æ–°é—»ç¨¿</text>
        </view>
      </view>

      <!-- é¡¹ç›®è¿›åº¦åˆ—çš„è¾“å…¥ç•Œé¢ -->
      <view class="progress-add-inputs">
        <!-- æ—¶é—´è¾“å…¥æ¡† -->
        <view class="input-section" wx:if="{{showTimeInput}}">
          <text class="input-label">æ·»åŠ æ—¶é—´</text>
          <picker
            mode="date"
            value="{{selectedDate}}"
            bindchange="onDateChange"
            class="form-input"
          >
            <view class="picker-text">{{selectedDate || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
          </picker>
          
          <button class="add-btn" bindtap="confirmAddTime">æ·»åŠ æ—¶é—´</button>
        </view>

        <!-- åœ°ç‚¹è¾“å…¥æ¡† -->
        <view class="input-section" wx:if="{{showLocationInput}}">
          <text class="input-label">æ·»åŠ åœ°ç‚¹</text>
          <input
            class="form-input"
            placeholder="è¯·è¾“å…¥åœ°ç‚¹åç§°"
            value="{{locationName}}"
            bindinput="onLocationInput"
          />
          <button class="add-btn" bindtap="confirmAddLocation">æ·»åŠ åœ°ç‚¹</button>
        </view>

        <!-- äººå‘˜è¾“å…¥æ¡† -->
        <view class="input-section" wx:if="{{showPersonInput}}">
          <text class="input-label">æ·»åŠ äººå‘˜</text>
          <input
            class="form-input"
            placeholder="è¯·è¾“å…¥äººå‘˜å§“å"
            value="{{personName}}"
            bindinput="onPersonNameInput"
          />
          <button class="add-btn" bindtap="confirmAddPerson">æ·»åŠ äººå‘˜</button>
        </view>

        <!-- å·²æ·»åŠ çš„å†…å®¹åˆ—è¡¨ -->
        <view class="added-content" wx:if="{{addedItems.length > 0}}">
          <text class="content-label">å·²æ·»åŠ çš„å†…å®¹ï¼š</text>
          <view
            class="added-item"
            wx:for="{{addedItems}}"
            wx:key="index"
          >
            <text class="item-type">{{item.type}}</text>
            <text class="item-name">{{item.name}}</text>
            <view class="item-actions">
              <button class="remove-btn" bindtap="removeItem" data-index="{{index}}">åˆ é™¤</button>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å…¶ä»–åˆ—çš„æ·»åŠ å†…å®¹ç•Œé¢ -->
    <view wx:else class="add-content-simple">
      <!-- è”ç³»äººä¿¡æ¯åˆ— -->
      <view wx:if="{{selectedColumn.key === 'contacts'}}" class="simple-add-section">
        <view class="add-input-area">
          <text class="input-label">æ·»åŠ è”ç³»äººä¿¡æ¯</text>
          <input
            class="form-input"
            placeholder="æ ¼å¼ï¼šå§“å:ç”µè¯å·ç "
            value="{{newContent}}"
            bindinput="onNewContentInput"
          />
          <view class="input-hint">ä¾‹å¦‚ï¼šå¼ ä¸‰:13800138000</view>
        </view>
      </view>

      <!-- æ¶‰åŠå…¸å‹å¿é•‡æ‘åˆ— -->
      <view wx:elif="{{selectedColumn.key === 'involvedAreas'}}" class="simple-add-section">
        <view class="add-input-area">
          <text class="input-label">æ·»åŠ æ¶‰åŠåŒºåŸŸ</text>
          <input
            class="form-input"
            placeholder="è¯·è¾“å…¥å¿/é•‡/æ‘ä¿¡æ¯"
            value="{{newContent}}"
            bindinput="onNewContentInput"
          />
          <view class="input-hint">ä¾‹å¦‚ï¼šä¸´å®‰åŒºé’å±±æ¹–è¡—é“</view>
        </view>
      </view>

      <!-- å¤šè¡Œæ–‡æœ¬ç±»å‹åˆ— -->
      <view wx:elif="{{selectedColumn.type === 'textarea'}}" class="simple-add-section">
        <view class="add-input-area">
          <text class="input-label">æ·»åŠ {{selectedColumn.name}}</text>
          <textarea
            class="form-textarea"
            placeholder="è¯·è¾“å…¥è¦æ·»åŠ çš„å†…å®¹"
            value="{{newContent}}"
            bindinput="onNewContentInput"
            maxlength="500"
          ></textarea>
          <view class="input-hint">æœ€å¤š500å­—ç¬¦</view>
        </view>
      </view>

      <!-- å…¶ä»–æ–‡æœ¬ç±»å‹åˆ— -->
      <view wx:else class="simple-add-section">
        <view class="add-input-area">
          <text class="input-label">æ·»åŠ {{selectedColumn.name}}</text>
          <input
            class="form-input"
            placeholder="è¯·è¾“å…¥è¦æ·»åŠ çš„{{selectedColumn.name}}"
            value="{{newContent}}"
            bindinput="onNewContentInput"
          />
        </view>
      </view>
    </view>

    <view class="button-group">
      <!-- é¡¹ç›®è¿›åº¦åˆ—ä½¿ç”¨åŸæœ‰çš„ä¿å­˜é€»è¾‘ -->
      <button
        wx:if="{{selectedColumn.key === 'progress'}}"
        class="save-btn"
        bindtap="saveAddition"
        disabled="{{addedItems.length === 0}}"
      >ä¿å­˜æ·»åŠ </button>

      <!-- å…¶ä»–åˆ—ä½¿ç”¨ç®€å•çš„ä¿å­˜é€»è¾‘ -->
      <button
        wx:else
        class="save-btn"
        bindtap="saveSimpleAddition"
        disabled="{{!newContent.trim()}}"
      >ä¿å­˜æ·»åŠ </button>

      <button class="back-btn" bindtap="prevStep">ä¸Šä¸€æ­¥</button>
    </view>
  </view>

  <!-- æ­¥éª¤4ï¼šåˆ é™¤å†…å®¹ - ä»…é¡¹ç›®è¿›åº¦åˆ— -->
  <view class="step-section" wx:if="{{currentStep === 4 && selectedAction === 'delete' && selectedColumn.key === 'progress'}}">
    <view class="step-header">
      <text class="step-title">åˆ é™¤å†…å®¹</text>
      <text class="step-subtitle">{{selectedProject.name}} - {{selectedColumn.name}}</text>
    </view>

    <!-- æ—¶é—´ç­›é€‰åŒºåŸŸ -->
    <view class="delete-filter-section">
      <view class="filter-title-area">
        <view class="filter-icon">ğŸ•’</view>
        <text class="filter-main-title">æ—¶é—´ç­›é€‰é€‰æ‹©æ—¶é—´æ®µæŸ¥çœ‹è¿›åº¦è®°å½•</text>
      </view>

      <!-- æ—¶é—´æ®µæŒ‰é’® -->
      <view class="time-filter-buttons">
        <view class="time-filter-item {{timeFilter === 'week' ? 'active' : ''}}" bindtap="filterByTime" data-filter="week">
          <text class="filter-text">æœ€è¿‘ä¸€å‘¨</text>
        </view>
        <view class="time-filter-item {{timeFilter === 'month' ? 'active' : ''}}" bindtap="filterByTime" data-filter="month">
          <text class="filter-text">æœ€è¿‘ä¸€æœˆ</text>
        </view>
        <view class="time-filter-item {{timeFilter === 'year' ? 'active' : ''}}" bindtap="filterByTime" data-filter="year">
          <text class="filter-text">æœ€è¿‘ä¸€å¹´</text>
        </view>
        <view class="time-filter-item {{timeFilter === 'all' ? 'active' : ''}}" bindtap="filterByTime" data-filter="all">
          <text class="filter-text">æŸ¥çœ‹å…¨éƒ¨</text>
        </view>
      </view>

      <!-- è‡ªå®šä¹‰æ—¥æœŸé€‰æ‹© -->
      <view class="custom-date-area">
        <picker mode="date" value="{{selectedDeleteDate}}" bindchange="onDeleteDateChange">
          <view class="custom-date-picker">
            <view class="date-icon">ğŸ“…</view>
            <text class="date-text">{{selectedDeleteDate || 'é€‰æ‹©å…·ä½“æ—¥æœŸ'}}</text>
            <view class="date-arrow">â–¼</view>
          </view>
        </picker>
      </view>
    </view>

    <!-- ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡ -->
    <view class="delete-stats-area">
      <view class="stats-item">
        <text class="stats-num">{{filteredProgressList.length}}</text>
        <text class="stats-desc">å½“å‰è®°å½•æ•°</text>
      </view>
      <view class="stats-item">
        <text class="stats-num">{{selectedDeleteCount}}</text>
        <text class="stats-desc">å·²é€‰æ‹©</text>
      </view>
    </view>

    <!-- æ‰¹é‡æ“ä½œæŒ‰é’® -->
    <view class="batch-operation-area" wx:if="{{selectedDeleteCount > 0}}">
      <view class="batch-select-btn" bindtap="selectAllProgress">
        <text class="batch-text">{{isAllProgressSelected ? 'å–æ¶ˆå…¨é€‰' : 'å…¨é€‰'}}</text>
      </view>
      <view class="batch-delete-btn" bindtap="batchDeleteProgress">
        <text class="batch-text">æ‰¹é‡åˆ é™¤ ({{selectedDeleteCount}})</text>
      </view>
    </view>

    <!-- è¿›åº¦è®°å½•åŒºåŸŸ -->
    <view class="delete-progress-area">
      <view class="progress-area-header">
        <view class="progress-icon">ğŸ“‹</view>
        <view class="progress-header-text">
          <text class="progress-main-text">è¿›åº¦è®°å½•ç‚¹å‡»é€‰æ‹©è¦åˆ é™¤çš„è®°å½•</text>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="delete-empty-state" wx:if="{{filteredProgressList.length === 0}}">
        <view class="empty-icon-large">ğŸ“­</view>
        <text class="empty-message">æš‚æ— ç¬¦åˆæ¡ä»¶çš„è¿›åº¦è®°å½•</text>
      </view>

      <!-- è¿›åº¦è®°å½•åˆ—è¡¨ -->
      <view class="delete-progress-list" wx:if="{{filteredProgressList.length > 0}}">
        <view
          class="delete-progress-item {{item.selected ? 'item-selected' : ''}}"
          wx:for="{{filteredProgressList}}"
          wx:key="id"
          bindtap="toggleProgressSelect"
          data-id="{{item.id}}"
        >
          <!-- é€‰æ‹©æ¡† -->
          <view class="item-checkbox {{item.selected ? 'checkbox-checked' : ''}}">
            <text class="checkbox-icon">{{item.selected ? 'âœ“' : ''}}</text>
          </view>

          <!-- è¿›åº¦ä¿¡æ¯ -->
          <view class="item-content">
            <text class="item-title">{{item.title}}</text>

            <view class="item-details">
              <view class="detail-row">
                <text class="detail-label">ğŸ“…</text>
                <text class="detail-value">{{item.date}}</text>
              </view>
              <view class="detail-row">
                <text class="detail-label">ğŸ‘¤</text>
                <text class="detail-value">{{item.person}}</text>
              </view>
              <view class="detail-row">
                <text class="detail-label">ğŸ“</text>
                <text class="detail-value">{{item.location}}</text>
              </view>
            </view>
          </view>

          <!-- çŠ¶æ€åŒºåŸŸ -->
          <view class="delete-status-area">
            <view class="status-time-info">
              <text class="status-date">{{item.date}}</text>
            </view>
            <view class="status-badge {{item.status}}">{{item.statusText}}</view>
          </view>

          <!-- åˆ é™¤æŒ‰é’® -->
          <view class="item-delete-btn" bindtap="singleDeleteProgress" data-id="{{item.id}}" catchtap="singleDeleteProgress">
            <text class="delete-btn-icon">ğŸ—‘ï¸</text>
          </view>
        </view>
      </view>
    </view>

    <view class="button-group">
      <button class="back-btn" bindtap="prevStep">ä¸Šä¸€æ­¥</button>
    </view>
  </view>
</view>