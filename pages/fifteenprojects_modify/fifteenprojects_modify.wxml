<view class="modify-container">
  <view class="page-header">
    <text class="page-title">åˆ æ”¹é¡¹ç›®</text>
    <text class="page-subtitle">é€‰æ‹©é¡¹ç›®å’Œåˆ—è¿›è¡Œä¿®æ”¹æˆ–æ·»åŠ å†…å®¹</text>
  </view>

  <!-- æ­¥éª¤1ï¼šé€‰æ‹©é¡¹ç›® -->
  <view class="step-section" wx:if="{{currentStep === 1}}">
    <view class="step-header">
      <text class="step-title">æ­¥éª¤1ï¼šé€‰æ‹©ç¬¬å‡ ä¸ªé¡¹ç›®</text>
    </view>

    <view class="project-list">
      <view
        class="project-item {{selectedProject && selectedProject.id === item.id ? 'selected' : ''}}"
        wx:for="{{projectList}}"
        wx:key="id"
        bindtap="selectProject"
        data-project="{{item}}"
      >
        <view class="project-number">ç¬¬{{index + 1}}ä¸ª</view>
        <view class="project-info">
          <view class="project-name">{{item.name}}</view>
          <view class="project-desc">{{item.description}}</view>
        </view>
        <view class="select-icon">{{selectedProject && selectedProject.id === item.id ? 'âœ“' : 'â—‹'}}</view>
      </view>
    </view>

    <view class="button-group">
      <button class="next-btn" bindtap="nextStep" disabled="{{!selectedProject}}">ä¸‹ä¸€æ­¥</button>
      <button class="cancel-btn" bindtap="cancel">å–æ¶ˆ</button>
    </view>
  </view>

  <!-- æ­¥éª¤2ï¼šé€‰æ‹©åˆ— -->
  <view class="step-section" wx:if="{{currentStep === 2}}">
    <view class="step-header">
      <text class="step-title">æ­¥éª¤2ï¼šé€‰æ‹©ç¬¬å‡ åˆ—</text>
      <text class="step-subtitle">å½“å‰é¡¹ç›®ï¼š{{selectedProject.name}}</text>
    </view>

    <view class="column-list">
      <view
        class="column-item {{selectedColumn && selectedColumn.key === item.key ? 'selected' : ''}}"
        wx:for="{{projectColumns}}"
        wx:key="key"
        bindtap="selectColumn"
        data-column="{{item}}"
      >
        <view class="column-number">ç¬¬{{index + 1}}åˆ—</view>
        <view class="column-info">
          <view class="column-name">{{item.name}}</view>
          <view class="column-current">å½“å‰å†…å®¹ï¼š{{selectedProject[item.key] || 'æš‚æ— '}}</view>
        </view>
        <view class="select-icon">{{selectedColumn && selectedColumn.key === item.key ? 'âœ“' : 'â—‹'}}</view>
      </view>
    </view>

    <view class="button-group">
      <button class="next-btn" bindtap="nextStep" disabled="{{!selectedColumn}}">ä¸‹ä¸€æ­¥</button>
      <button class="back-btn" bindtap="prevStep">ä¸Šä¸€æ­¥</button>
    </view>
  </view>

  <!-- æ­¥éª¤3ï¼šé€‰æ‹©æ“ä½œç±»å‹ -->
  <view class="step-section" wx:if="{{currentStep === 3}}">
    <view class="step-header">
      <text class="step-title">æ­¥éª¤3ï¼šé€‰æ‹©æ“ä½œç±»å‹</text>
      <text class="step-subtitle">{{selectedProject.name}} - {{selectedColumn.name}}</text>
    </view>

    <view class="action-list">
      <view
        class="action-item {{selectedAction === 'modify' ? 'selected' : ''}}"
        bindtap="selectAction"
        data-action="modify"
      >
        <view class="action-icon">âœï¸</view>
        <view class="action-info">
          <view class="action-name">ä¿®æ”¹å†…å®¹</view>
          <view class="action-desc">ä¿®æ”¹å½“å‰åˆ—çš„æ–‡å­—å†…å®¹</view>
        </view>
        <view class="select-icon">{{selectedAction === 'modify' ? 'âœ“' : 'â—‹'}}</view>
      </view>

      <view
        class="action-item {{selectedAction === 'add' ? 'selected' : ''}}"
        bindtap="selectAction"
        data-action="add"
      >
        <view class="action-icon">ğŸ“</view>
        <view class="action-info">
          <view class="action-name">æ·»åŠ å†…å®¹</view>
          <view class="action-desc">æ·»åŠ å›¾ç‰‡ã€è§†é¢‘ã€é“¾æ¥ã€æ–°é—»ç¨¿ç­‰</view>
        </view>
        <view class="select-icon">{{selectedAction === 'add' ? 'âœ“' : 'â—‹'}}</view>
      </view>
    </view>

    <view class="button-group">
      <button class="next-btn" bindtap="nextStep" disabled="{{!selectedAction}}">ä¸‹ä¸€æ­¥</button>
      <button class="back-btn" bindtap="prevStep">ä¸Šä¸€æ­¥</button>
    </view>
  </view>

  <!-- æ­¥éª¤4ï¼šä¿®æ”¹å†…å®¹ -->
  <view class="step-section" wx:if="{{currentStep === 4 && selectedAction === 'modify'}}">
    <view class="step-header">
      <text class="step-title">ä¿®æ”¹å†…å®¹</text>
      <text class="step-subtitle">{{selectedProject.name}} - {{selectedColumn.name}}</text>
    </view>

    <view class="modify-content">
      <view class="current-content">
        <text class="content-label">å½“å‰å†…å®¹ï¼š</text>
        <text class="content-text">{{selectedProject[selectedColumn.key] || 'æš‚æ— å†…å®¹'}}</text>
      </view>

      <view class="new-content">
        <text class="content-label">æ–°å†…å®¹ï¼š</text>
        <textarea
          class="content-input"
          placeholder="è¯·è¾“å…¥æ–°çš„å†…å®¹"
          value="{{newContent}}"
          bindinput="onNewContentInput"
          maxlength="1000"
        />
      </view>
    </view>

    <view class="button-group">
      <button class="save-btn" bindtap="saveModification">ä¿å­˜ä¿®æ”¹</button>
      <button class="back-btn" bindtap="prevStep">ä¸Šä¸€æ­¥</button>
    </view>
  </view>

  <!-- æ­¥éª¤4ï¼šæ·»åŠ å†…å®¹ -->
  <view class="step-section" wx:if="{{currentStep === 4 && selectedAction === 'add'}}">
    <view class="step-header">
      <text class="step-title">æ·»åŠ å†…å®¹</text>
      <text class="step-subtitle">{{selectedProject.name}} - {{selectedColumn.name}}</text>
    </view>

    <view class="add-content">
      <view class="upload-options">
        <view class="upload-item" bindtap="uploadImage">
          <view class="upload-icon">ğŸ–¼ï¸</view>
          <text class="upload-text">æ·»åŠ å›¾ç‰‡</text>
        </view>

        <view class="upload-item" bindtap="uploadVideo">
          <view class="upload-icon">ğŸ¥</view>
          <text class="upload-text">æ·»åŠ è§†é¢‘</text>
        </view>

        <view class="upload-item" bindtap="addLink">
          <view class="upload-icon">ğŸ”—</view>
          <text class="upload-text">æ·»åŠ é“¾æ¥</text>
        </view>

        <view class="upload-item" bindtap="uploadDocument">
          <view class="upload-icon">ğŸ“„</view>
          <text class="upload-text">æ·»åŠ æ–°é—»ç¨¿</text>
        </view>
      </view>

      <!-- é“¾æ¥è¾“å…¥æ¡† -->
      <view class="link-input" wx:if="{{showLinkInput}}">
        <input
          class="form-input"
          placeholder="è¯·è¾“å…¥é“¾æ¥åœ°å€"
          value="{{linkUrl}}"
          bindinput="onLinkInput"
        />
        <input
          class="form-input"
          placeholder="è¯·è¾“å…¥é“¾æ¥æ ‡é¢˜"
          value="{{linkTitle}}"
          bindinput="onLinkTitleInput"
        />
        <button class="add-link-btn" bindtap="confirmAddLink">ç¡®è®¤æ·»åŠ </button>
      </view>

      <!-- å·²æ·»åŠ çš„å†…å®¹åˆ—è¡¨ -->
      <view class="added-content" wx:if="{{addedItems.length > 0}}">
        <text class="content-label">å·²æ·»åŠ çš„å†…å®¹ï¼š</text>
        <view
          class="added-item"
          wx:for="{{addedItems}}"
          wx:key="index"
        >
          <text class="item-type">{{item.type}}</text>
          <text class="item-name">{{item.name}}</text>
          <view class="item-actions">
            <button class="remove-btn" bindtap="removeItem" data-index="{{index}}">åˆ é™¤</button>
          </view>
        </view>
      </view>
    </view>

    <view class="button-group">
      <button class="save-btn" bindtap="saveAddition" disabled="{{addedItems.length === 0}}">ä¿å­˜æ·»åŠ </button>
      <button class="back-btn" bindtap="prevStep">ä¸Šä¸€æ­¥</button>
    </view>
  </view>
</view>
