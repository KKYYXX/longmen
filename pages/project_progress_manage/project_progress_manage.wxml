<view class="manage-container">
  <view class="texture-overlay"></view>
  <view class="light-spot"></view>
  
  <!-- å¤´éƒ¨å¯¼èˆª -->
  <view class="header">
    <view class="back-btn" bindtap="navigateBack">
      <text class="back-icon">â†</text>
    </view>
    <view class="title-box">
      <text class="title">é¡¹ç›®è¿›åº¦ç®¡ç†</text>
      <text class="subtitle">{{selectedProject ? selectedProject.projectName : 'é€‰æ‹©é¡¹ç›®'}}</text>
    </view>
    <view class="action-btn" wx:if="{{selectedProject}}" bindtap="showAddForm">
      <text class="action-icon">â•</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- é¡¹ç›®é€‰æ‹©åˆ—è¡¨ -->
  <view class="project-list" wx:if="{{!selectedProject && !loading}}">
    <view class="section-header">
      <text class="section-title">ğŸ“‹ é€‰æ‹©è¦ç®¡ç†çš„é¡¹ç›®</text>
      <text class="section-subtitle">ç‚¹å‡»é¡¹ç›®æŸ¥çœ‹å’Œç®¡ç†è¿›åº¦</text>
    </view>
    
    <view class="project-grid">
      <view 
        class="project-card" 
        wx:for="{{projectList}}" 
        wx:key="id"
        bindtap="selectProject"
        data-project="{{item}}"
      >
        <view class="project-info">
          <text class="project-name">{{item.projectName}}</text>
          <text class="project-type">{{item.projectType}}</text>
        </view>
        <view class="project-arrow">â†’</view>
      </view>
    </view>
  </view>

  <!-- è¿›åº¦ç®¡ç†ç•Œé¢ -->
  <view class="progress-manage" wx:if="{{selectedProject && !loading}}">
    <view class="project-header">
      <view class="back-project-btn" bindtap="backToProjectList">
        <text class="back-icon">â†</text>
      </view>
      <view class="project-info">
        <text class="project-name">{{selectedProject.projectName}}</text>
        <text class="project-type">{{selectedProject.projectType}}</text>
      </view>
    </view>

    <!-- è¿›åº¦åˆ—è¡¨ -->
    <view class="progress-list">
      <view class="list-header">
        <text class="list-title">ğŸ“ˆ é¡¹ç›®è¿›åº¦è®°å½•</text>
        <text class="list-count">å…± {{progressList.length}} æ¡è®°å½•</text>
      </view>

      <view class="progress-items">
        <view 
          class="progress-item" 
          wx:for="{{progressList}}" 
          wx:key="id"
        >
          <view class="progress-content">
            <view class="progress-header">
              <text class="progress-title">{{item.title}}</text>
              <text class="progress-status {{item.status}}">{{item.statusText}}</text>
            </view>
            
            <view class="progress-details">
              <view class="detail-row">
                <text class="detail-label">ğŸ“… æ—¶é—´ï¼š</text>
                <text class="detail-value">{{item.date}} {{item.time}}</text>
              </view>
              <view class="detail-row">
                <text class="detail-label">ğŸ“ åœ°ç‚¹ï¼š</text>
                <text class="detail-value">{{item.location}}</text>
              </view>
              <view class="detail-row">
                <text class="detail-label">ğŸ‘¤ è´Ÿè´£äººï¼š</text>
                <text class="detail-value">{{item.person}}</text>
              </view>
              <view class="detail-row">
                <text class="detail-label">ğŸ“ æè¿°ï¼š</text>
                <text class="detail-value">{{item.description}}</text>
              </view>
            </view>

            <!-- å®Œæˆåº¦ -->
            <view class="completion-info" wx:if="{{item.completion}}">
              <text class="completion-label">å®Œæˆåº¦ï¼š</text>
              <view class="completion-bar">
                <view class="completion-fill" style="width: {{item.completion}}%"></view>
              </view>
              <text class="completion-text">{{item.completion}}%</text>
            </view>
          </view>

          <view class="progress-actions">
            <view class="action-btn edit-btn" bindtap="editProgress" data-progress="{{item}}">
              <text class="action-icon">âœï¸</text>
            </view>
            <view class="action-btn delete-btn" bindtap="deleteProgress" data-progress="{{item}}">
              <text class="action-icon">ğŸ—‘ï¸</text>
            </view>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-progress" wx:if="{{progressList.length === 0}}">
        <text class="empty-icon">ğŸ“ˆ</text>
        <text class="empty-text">æš‚æ— è¿›åº¦è®°å½•</text>
        <text class="empty-hint">ç‚¹å‡»å³ä¸Šè§’ â• æ·»åŠ è¿›åº¦è®°å½•</text>
      </view>
    </view>
  </view>

  <!-- æ·»åŠ /ç¼–è¾‘è¡¨å• -->
  <view class="form-overlay" wx:if="{{showAddForm}}" bindtap="hideForm">
    <view class="form-container" catchtap="">
      <view class="form-header">
        <text class="form-title">{{editingProgress ? 'ç¼–è¾‘' : 'æ·»åŠ '}}è¿›åº¦è®°å½•</text>
        <view class="close-btn" bindtap="hideForm">
          <text class="close-icon">âœ•</text>
        </view>
      </view>

      <view class="form-content">
        <view class="form-group">
          <text class="form-label">æ—¥æœŸ</text>
          <picker mode="date" value="{{formData.date}}" bindchange="onDateChange">
            <view class="form-input picker-input">
              <text>{{formData.date || 'é€‰æ‹©æ—¥æœŸ'}}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
        </view>

        <view class="form-group">
          <text class="form-label">æ—¶é—´</text>
          <picker mode="time" value="{{formData.time}}" bindchange="onTimeChange">
            <view class="form-input picker-input">
              <text>{{formData.time || 'é€‰æ‹©æ—¶é—´'}}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
        </view>

        <view class="form-group">
          <text class="form-label">æ ‡é¢˜</text>
          <input 
            class="form-input" 
            placeholder="è¯·è¾“å…¥è¿›åº¦æ ‡é¢˜"
            value="{{formData.title}}"
            bindinput="onFormInput"
            data-field="title"
          />
        </view>

        <view class="form-group">
          <text class="form-label">åœ°ç‚¹</text>
          <input 
            class="form-input" 
            placeholder="è¯·è¾“å…¥åœ°ç‚¹"
            value="{{formData.location}}"
            bindinput="onFormInput"
            data-field="location"
          />
        </view>

        <view class="form-group">
          <text class="form-label">è´Ÿè´£äºº</text>
          <input 
            class="form-input" 
            placeholder="è¯·è¾“å…¥è´Ÿè´£äºº"
            value="{{formData.person}}"
            bindinput="onFormInput"
            data-field="person"
          />
        </view>

        <view class="form-group">
          <text class="form-label">çŠ¶æ€</text>
          <picker range="{{['å¾…å¼€å§‹', 'è¿›è¡Œä¸­', 'å·²å®Œæˆ']}}" bindchange="onStatusChange">
            <view class="form-input picker-input">
              <text>{{formData.status === 'pending' ? 'å¾…å¼€å§‹' : formData.status === 'ongoing' ? 'è¿›è¡Œä¸­' : 'å·²å®Œæˆ'}}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
        </view>

        <view class="form-group">
          <text class="form-label">å®Œæˆåº¦ï¼š{{formData.completion}}%</text>
          <slider 
            value="{{formData.completion}}" 
            min="0" 
            max="100" 
            step="5"
            bindchange="onCompletionChange"
            activeColor="#007AFF"
            backgroundColor="#E5E5E5"
          />
        </view>

        <view class="form-group">
          <text class="form-label">æè¿°</text>
          <textarea 
            class="form-textarea" 
            placeholder="è¯·è¾“å…¥è¯¦ç»†æè¿°"
            value="{{formData.description}}"
            bindinput="onFormInput"
            data-field="description"
            maxlength="500"
          />
        </view>
      </view>

      <view class="form-actions">
        <view class="form-btn cancel-btn" bindtap="hideForm">
          <text>å–æ¶ˆ</text>
        </view>
        <view class="form-btn save-btn" bindtap="saveProgress">
          <text>{{editingProgress ? 'ä¿å­˜' : 'æ·»åŠ '}}</text>
        </view>
      </view>
    </view>
  </view>
</view>
