<!-- é¡µé¢å®¹å™¨ -->
<view class="fifteen-projects-query-container">
  <!-- æœç´¢åŒºåŸŸ -->
  <view class="search-section">
    <!-- æ—¶é—´ç­›é€‰ -->
    <view class="filter-row">
      <text class="filter-label">æŒ‰é¡¹ç›®å¼€å§‹æ—¶é—´ç­›é€‰ï¼š</text>
      <picker mode="date" value="{{startDate}}" bindchange="onStartDateChange">
        <view class="date-picker">
          <text>{{startDate || 'å¼€å§‹æ—¶é—´'}}</text>
        </view>
      </picker>
      <text class="date-separator">è‡³</text>
      <picker mode="date" value="{{endDate}}" bindchange="onEndDateChange">
        <view class="date-picker">
          <text>{{endDate || 'ç»“æŸæ—¶é—´'}}</text>
        </view>
      </picker>
      <view class="clear-filter-btn" bindtap="clearTimeFilter" wx:if="{{startDate || endDate}}">
        <text class="clear-text">æ¸…é™¤ç­›é€‰</text>
      </view>
      
    </view>
    
         <!-- ç­›é€‰çŠ¶æ€æç¤º -->
     <view class="filter-status" wx:if="{{startDate || endDate || searchKeyword}}">
       <text class="result-count">æ˜¾ç¤º {{projectList.length}} æ¡è®°å½•ï¼Œå…± {{allProjects.length}} æ¡</text>
     </view>
    
    <!-- åç§°æœç´¢ -->
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input class="search-input"
             placeholder="æœç´¢é¡¹ç›®åç§°..."
             value="{{searchKeyword}}"
             bindinput="onSearchInput"
             bindconfirm="onSearch"/>
      <view class="search-actions">
        <text class="clear-search-btn" bindtap="clearSearch" wx:if="{{searchKeyword}}">âœ•</text>
        <text class="search-btn" bindtap="onSearch">æœç´¢</text>
      </view>
    </view>
  </view>

  <!-- é¡¹ç›®åˆ—è¡¨ -->
  <view class="project-list">
    <view
      class="project-item"
      wx:for="{{projectList}}"
      wx:key="id"
      bindtap="onProjectTap"
      data-index="{{index}}"
    >
      <!-- é¡¹ç›®å¤´éƒ¨ -->
      <view class="project-header">
        <view class="project-info">
          <view class="project-icon">ğŸ—ï¸</view>
          <view class="project-details">
            <view class="project-name">{{item.projectName}}</view>
            <view class="project-meta">
              <text class="project-start-date">å¼€å§‹æ—¶é—´ï¼š{{item.startDate || 'æœªè®¾ç½®'}}</text>
            </view>
          </view>
        </view>
        <view class="project-actions">
          <view class="view-detail-btn">
            <view class="view-icon">ğŸ‘ï¸</view>
            <text class="view-text">æŸ¥çœ‹è¯¦æƒ…</text>
          </view>
        </view>
      </view>

      <!-- ä¸»è¦ç›®æ ‡ -->
      <view class="project-summary">
        <view class="summary-label">ä¸»è¦ç›®æ ‡ï¼š</view>
        <text class="summary-text">{{item.objectives || 'æš‚æ— ç›®æ ‡æè¿°'}}</text>
        <view class="summary-more" wx:if="{{item.objectives && item.objectives.length > 50}}">
          <text class="more-text">ç‚¹å‡»æŸ¥çœ‹å®Œæ•´å†…å®¹</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore && !loading}}" bindtap="loadMore">
    <text>åŠ è½½æ›´å¤š</text>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
  <view class="no-more" wx:if="{{!hasMore && projectList.length > 0}}">
    <text>æ²¡æœ‰æ›´å¤šæ•°æ®äº†</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{projectList.length === 0 && !loading}}">
    <text class="empty-icon">ğŸ—ï¸</text>
    <text class="empty-text">æš‚æ— åäº”é¡¹é¡¹ç›®æ•°æ®</text>
  </view>

  
</view>

<!-- é¡¹ç›®è¯¦æƒ…å¼¹çª— -->
<view class="project-detail-modal" wx:if="{{showProjectDetail}}">
  <view class="modal-mask" bindtap="closeProjectDetail"></view>
  <view class="modal-content">
    <!-- å¼¹çª—å¤´éƒ¨ -->
    <view class="modal-header">
      <view class="modal-title">{{selectedProject.projectName}}</view>
      <view class="close-btn" bindtap="closeProjectDetail">âœ•</view>
    </view>

    <!-- é¡¹ç›®è¯¦ç»†ä¿¡æ¯ -->
    <view class="project-info-section">
      <view class="info-item">
        <view class="info-label">åºå·</view>
        <view class="info-value">{{selectedProject.serialNumber || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">åœ°çº§å¸‚</view>
        <view class="info-value">{{selectedProject.cityLevel || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">ç»“å¯¹å¿ï¼ˆå¸‚ã€åŒºï¼‰</view>
        <view class="info-value">{{selectedProject.pairedCounty || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">ç»„å›¢ç»“å¯¹é«˜æ ¡é™¢æ‰€</view>
        <view class="info-value">{{selectedProject.pairedInstitution || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">é¡¹ç›®åç§°</view>
        <view class="info-value">{{selectedProject.projectName}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">é¡¹ç›®å®æ–½å•ä½ï¼ˆé«˜æ ¡é™¢æ‰€ï¼‰</view>
        <view class="info-value">{{selectedProject.implementationUnit || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">æ˜¯å¦é‡ç‚¹é¡¹ç›®</view>
        <view class="info-value">{{selectedProject.isKeyProject || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">æ¶‰åŠå…¸å‹å¿é•‡æ‘</view>
        <view class="info-value">{{selectedProject.involvedAreas || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">é¡¹ç›®ç±»å‹</view>
        <view class="info-value">{{selectedProject.projectType}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">é¡¹ç›®å¼€å§‹æ—¶é—´</view>
        <view class="info-value">{{selectedProject.startDate || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">é¡¹ç›®ç»“æŸæ—¶é—´</view>
        <view class="info-value">{{selectedProject.endDate || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">é¡¹ç›®èƒŒæ™¯</view>
        <view class="info-value long-text">{{selectedProject.background || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">é¡¹ç›®å†…å®¹å’Œè½å®ä¸¾æª</view>
        <view class="info-value long-text">{{selectedProject.content || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">ä¸»è¦ä»»åŠ¡ç›®æ ‡</view>
        <view class="info-value long-text">{{selectedProject.objectives || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">è”ç³»äººä¿¡æ¯</view>
        <view class="info-value">
          <!-- æœ‰è”ç³»äººæ•°æ®æ—¶æ˜¾ç¤º -->
          <view class="contact-list" wx:if="{{selectedProject.contacts && selectedProject.contacts.length > 0}}">
            <view class="contact-item" wx:for="{{selectedProject.contacts}}" wx:key="index">
              <text class="contact-name">{{item.name || item.contact_name || 'å§“åæœªçŸ¥'}}</text>
              <text class="contact-phone">{{item.phone || item.contact_phone || item.telephone || 'ç”µè¯æœªçŸ¥'}}</text>
            </view>
          </view>
          
          <!-- æ²¡æœ‰è”ç³»äººæ•°æ®æ—¶æ˜¾ç¤ºæç¤º -->
          <view class="no-contacts" wx:else>
            <text style="color: #999;">æš‚æ— è”ç³»äººä¿¡æ¯</text>
          </view>
        </view>
      </view>

      <view class="info-item">
        <view class="info-label">å¤‡æ³¨</view>
        <view class="info-value long-text">{{selectedProject.remarks || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">é¡¹ç›®è¿›åº¦</view>
        <view class="info-value">
          <view class="progress-display">
            <view class="progress-bar">
              <view class="progress-fill" style="width: {{selectedProject.progress || 0}}%"></view>
            </view>
            <text class="progress-text">{{selectedProject.progress || 0}}%</text>
          </view>
        </view>
      </view>
    </view>

    <!-- è¿›åº¦æŸ¥è¯¢æŒ‰é’®åŒºåŸŸ -->
    <view class="progress-query-section">
      <view class="section-title">è¿›åº¦æŸ¥è¯¢</view>
      <view class="progress-query-btn" bindtap="onProgressQueryClick">
        <text class="btn-icon">ğŸ“Š</text>
        <text class="btn-text">è¿›åº¦æŸ¥è¯¢</text>
      </view>
    </view>

    <!-- è¿›åº¦è®°å½•åŠ è½½ä¸­ -->
    <view class="progress-loading" wx:if="{{progressLoading}}">
      <text class="loading-icon">â³</text>
      <text class="loading-text">æ­£åœ¨æŸ¥è¯¢è¿›åº¦è®°å½•...</text>
    </view>

    <!-- è¿›åº¦è®°å½•åˆ—è¡¨ -->
    <view class="progress-records" wx:if="{{progressList.length > 0 && !progressLoading}}">
      <view class="records-title">è¿›åº¦è®°å½•</view>
      <view
        class="record-item"
        wx:for="{{progressList}}"
        wx:key="id"
      >
        <!-- è®°å½•å¤´éƒ¨ï¼šäººç‰©å’Œæ—¶é—´ -->
        <view class="record-header">
          <view class="record-person">
            <text class="person-icon">ğŸ‘¤</text>
            <text class="person-name">{{item.person}}</text>
          </view>
          <view class="record-time">
            <text class="time-icon">ğŸ•’</text>
            <text class="time-text">{{item.date}} {{item.time}}</text>
          </view>
        </view>
        
        <!-- åœ°ç‚¹ä¿¡æ¯ -->
        <view class="record-location" wx:if="{{item.location && item.location !== 'æœªçŸ¥åœ°ç‚¹'}}">
          <text class="location-icon">ğŸ“</text>
          <text class="location-text">{{item.location}}</text>
        </view>
        
        <!-- å·¥ä½œå†…å®¹ -->
        <view class="record-content">
          <text class="content-label">å·¥ä½œå†…å®¹ï¼š</text>
          <text class="content-text">{{item.content}}</text>
        </view>
        
        <!-- å¤šåª’ä½“èµ„æºåŒºåŸŸ -->
        <view class="record-media" wx:if="{{item.originalData.practice_image_url || item.originalData.practice_video_url || item.originalData.news}}">
          <view class="media-title">ç›¸å…³èµ„æº</view>
          
          <!-- å›¾ç‰‡å±•ç¤º -->
          <view class="record-images" wx:if="{{item.originalData.practice_image_url}}">
            <view class="media-section">
              <text class="media-label">ğŸ“· ç°åœºå›¾ç‰‡</text>
              <view class="image-grid">
                <view class="image-item" wx:for="{{item.originalData.practice_image_url.split(',')}}" wx:key="index" wx:for-item="imageUrl">
                  <image 
                    src="{{imageUrl.trim()}}" 
                    mode="aspectFill" 
                    class="progress-image"
                    bindtap="previewImage"
                    data-urls="{{item.originalData.practice_image_url.split(',')}}"
                    data-current="{{imageUrl.trim()}}"
                  />
                </view>
              </view>
            </view>
          </view>
          
          <!-- è§†é¢‘å±•ç¤º -->
          <view class="record-video" wx:if="{{item.originalData.practice_video_url}}">
            <view class="media-section">
              <text class="media-label">ğŸ¥ ç°åœºè§†é¢‘</text>
              <view class="video-item">
                <video 
                  src="{{item.originalData.practice_video_url}}" 
                  class="progress-video"
                  controls
                  show-center-play-btn
                  show-play-btn
                  show-fullscreen-btn
                />
              </view>
            </view>
          </view>
          
          <!-- æ–‡ä»¶/æ–°é—»é“¾æ¥ -->
          <view class="record-files" wx:if="{{item.originalData.news}}">
            <view class="media-section">
              <text class="media-label">ğŸ“„ ç›¸å…³æ–‡ä»¶</text>
              <view class="file-item">
                <text class="file-icon">ğŸ“‹</text>
                <text class="file-name">{{item.originalData.news}}</text>
                <view class="file-actions">
                  <view class="view-btn" bindtap="viewFile" data-url="{{item.originalData.news}}">æŸ¥çœ‹</view>
                  <view class="download-btn" bindtap="downloadFile" data-url="{{item.originalData.news}}">ä¸‹è½½</view>
                </view>
              </view>
            </view>
          </view>
        </view>
        
        <!-- è®°å½•åº•éƒ¨ï¼šæ“ä½œæŒ‰é’® -->
        <view class="record-actions">
          <view class="action-btn" bindtap="shareRecord" data-record="{{item}}">
            <text class="action-icon">ğŸ“¤</text>
            <text class="action-text">åˆ†äº«</text>
          </view>
          <view class="action-btn" bindtap="exportRecord" data-record="{{item}}">
            <text class="action-icon">ğŸ“¥</text>
            <text class="action-text">å¯¼å‡º</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ— è¿›åº¦è®°å½•æç¤º -->
    <view class="no-progress" wx:if="{{showNoProgress && !progressLoading}}">
      <text class="no-progress-icon">ğŸ“‹</text>
      <text class="no-progress-text">è¯¥æ—¶é—´æ®µæš‚æ— è¿›åº¦è®°å½•</text>
    </view>
  </view>
</view>

