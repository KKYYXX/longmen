<!-- 页面容器 -->
<view class="fifteen-projects-query-container">
  <!-- 搜索区域 -->
  <view class="search-section">
    <!-- 时间筛选 -->
    <view class="filter-row">
      <text class="filter-label">时间筛选：</text>
      <picker mode="date" value="{{startDate}}" bindchange="onStartDateChange">
        <view class="date-picker">
          <text>{{startDate || '开始时间'}}</text>
        </view>
      </picker>
      <text class="date-separator">至</text>
      <picker mode="date" value="{{endDate}}" bindchange="onEndDateChange">
        <view class="date-picker">
          <text>{{endDate || '结束时间'}}</text>
        </view>
      </picker>
    </view>
    
    <!-- 名称搜索 -->
    <view class="search-box">
      <input
        class="search-input"
        placeholder="搜索项目名称..."
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearch"
      />
      <view class="search-btn" bindtap="onSearch">
        <text class="search-icon">🔍</text>
      </view>
    </view>
  </view>

  <!-- 项目列表 -->
  <view class="project-list">
    <view
      class="project-item"
      wx:for="{{projectList}}"
      wx:key="id"
      bindtap="onProjectTap"
      data-index="{{index}}"
    >
      <!-- 项目头部 -->
      <view class="project-header">
        <view class="project-info">
          <view class="project-icon">🏗️</view>
          <view class="project-details">
            <view class="project-name">{{item.projectName}}</view>
            <view class="project-meta">
              <text class="project-date">{{item.createDate || item.startDate}}</text>
            </view>
            <view class="project-type">{{item.projectType}}</view>
          </view>
        </view>
        <view class="project-actions">
          <view class="view-detail-btn">
            <view class="view-icon">👁️</view>
            <text class="view-text">查看详情</text>
          </view>
        </view>
      </view>

      <!-- 项目简介 -->
      <view class="project-summary">
        <text class="summary-text">{{item.objectives}}</text>
      </view>
    </view>
  </view>

  <!-- 加载更多 -->
  <view class="load-more" wx:if="{{hasMore && !loading}}" bindtap="loadMore">
    <text>加载更多</text>
  </view>

  <!-- 加载中 -->
  <view class="loading" wx:if="{{loading}}">
    <text>加载中...</text>
  </view>

  <!-- 没有更多数据 -->
  <view class="no-more" wx:if="{{!hasMore && projectList.length > 0}}">
    <text>没有更多数据了</text>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{projectList.length === 0 && !loading}}">
    <text class="empty-icon">🏗️</text>
    <text class="empty-text">暂无十五项项目数据</text>
  </view>
</view>

<!-- 项目详情弹窗 -->
<view class="project-detail-modal" wx:if="{{showProjectDetail}}">
  <view class="modal-mask" bindtap="closeProjectDetail"></view>
  <view class="modal-content">
    <!-- 弹窗头部 -->
    <view class="modal-header">
      <view class="modal-title">{{selectedProject.projectName}}</view>
      <view class="close-btn" bindtap="closeProjectDetail">✕</view>
    </view>

    <!-- 项目详细信息 -->
    <view class="project-info-section">
      <view class="info-item">
        <view class="info-label">项目名称</view>
        <view class="info-value">{{selectedProject.projectName}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">项目类型</view>
        <view class="info-value">{{selectedProject.projectType}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">创建时间</view>
        <view class="info-value">{{selectedProject.createDate || selectedProject.startDate}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">主要任务目标</view>
        <view class="info-value objectives-text">{{selectedProject.objectives}}</view>
      </view>
    </view>

    <!-- 时间查询按键区域 -->
    <view class="time-query-section">
      <view class="section-title">进度查询</view>
      <view class="time-buttons">
        <view
          class="time-btn {{selectedTimeRange === item.value ? 'active' : ''}}"
          wx:for="{{timeRangeOptions}}"
          wx:key="value"
          bindtap="onTimeRangeSelect"
          data-value="{{item.value}}"
        >
          {{item.label}}
        </view>
      </view>

      <!-- 自定义时间选择 -->
      <view class="custom-time-section">
        <view class="custom-time-row">
          <picker mode="date" value="{{customStartDate}}" bindchange="onCustomStartDateChange">
            <view class="custom-date-picker">
              <text>{{customStartDate || '开始日期'}}</text>
            </view>
          </picker>
          <text class="date-separator">至</text>
          <picker mode="date" value="{{customEndDate}}" bindchange="onCustomEndDateChange">
            <view class="custom-date-picker">
              <text>{{customEndDate || '结束日期'}}</text>
            </view>
          </picker>
          <view class="query-btn" bindtap="onCustomTimeQuery">查询</view>
        </view>
      </view>
    </view>

    <!-- 进度记录加载中 -->
    <view class="progress-loading" wx:if="{{progressLoading}}">
      <text class="loading-icon">⏳</text>
      <text class="loading-text">正在查询进度记录...</text>
    </view>

    <!-- 进度记录列表 -->
    <view class="progress-records" wx:if="{{progressList.length > 0 && !progressLoading}}">
      <view class="records-title">进度记录</view>
      <view
        class="record-item"
        wx:for="{{progressList}}"
        wx:key="id"
      >
        <view class="record-summary">
          <text class="summary-person">{{item.person}}</text>
          <text class="summary-connector">于</text>
          <text class="summary-datetime">{{item.date}} {{item.time}}</text>
          <text class="summary-connector">在</text>
          <text class="summary-location">{{item.location}}</text>
          <text class="summary-connector">进行了以下工作：</text>
        </view>
        <view class="record-content">{{item.content}}</view>
      </view>
    </view>

    <!-- 无进度记录提示 -->
    <view class="no-progress" wx:if="{{showNoProgress && !progressLoading}}">
      <text class="no-progress-icon">📋</text>
      <text class="no-progress-text">该时间段暂无进度记录</text>
    </view>
  </view>
</view>
