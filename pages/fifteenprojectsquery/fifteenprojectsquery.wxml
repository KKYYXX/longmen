<!-- é¡µé¢å®¹å™¨ -->
<view class="fifteen-projects-query-container">
  <!-- æœç´¢åŒºåŸŸ -->
  <view class="search-section">
    <!-- æ—¶é—´ç­›é€‰ -->
    <view class="filter-row">
      <text class="filter-label">æŒ‰é¡¹ç›®å¼€å§‹æ—¶é—´ç­›é€‰ï¼š</text>
      <picker mode="date" value="{{startDate}}" bindchange="onStartDateChange">
        <view class="date-picker">
          <text>{{startDate || 'å¼€å§‹æ—¶é—´'}}</text>
        </view>
      </picker>
      <text class="date-separator">è‡³</text>
      <picker mode="date" value="{{endDate}}" bindchange="onEndDateChange">
        <view class="date-picker">
          <text>{{endDate || 'ç»“æŸæ—¶é—´'}}</text>
        </view>
      </picker>
    </view>
    
    <!-- åç§°æœç´¢ -->
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input class="search-input"
             placeholder="æœç´¢é¡¹ç›®åç§°..."
             value="{{searchKeyword}}"
             bindinput="onSearchInput"
             bindconfirm="onSearch"/>
      <text class="search-btn" bindtap="onSearch">æœç´¢</text>
    </view>
  </view>

  <!-- é¡¹ç›®åˆ—è¡¨ -->
  <view class="project-list">
    <view
      class="project-item"
      wx:for="{{projectList}}"
      wx:key="id"
      bindtap="onProjectTap"
      data-index="{{index}}"
    >
      <!-- é¡¹ç›®å¤´éƒ¨ -->
      <view class="project-header">
        <view class="project-info">
          <view class="project-icon">ğŸ—ï¸</view>
          <view class="project-details">
            <view class="project-name">{{item.projectName}}</view>
            <view class="project-meta">
              <text class="project-start-date">å¼€å§‹æ—¶é—´ï¼š{{item.startDate || 'æœªè®¾ç½®'}}</text>
            </view>
          </view>
        </view>
        <view class="project-actions">
          <view class="view-detail-btn">
            <view class="view-icon">ğŸ‘ï¸</view>
            <text class="view-text">æŸ¥çœ‹è¯¦æƒ…</text>
          </view>
        </view>
      </view>

      <!-- ä¸»è¦ç›®æ ‡ -->
      <view class="project-summary">
        <view class="summary-label">ä¸»è¦ç›®æ ‡ï¼š</view>
        <text class="summary-text">{{item.objectives || 'æš‚æ— ç›®æ ‡æè¿°'}}</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore && !loading}}" bindtap="loadMore">
    <text>åŠ è½½æ›´å¤š</text>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
  <view class="no-more" wx:if="{{!hasMore && projectList.length > 0}}">
    <text>æ²¡æœ‰æ›´å¤šæ•°æ®äº†</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{projectList.length === 0 && !loading}}">
    <text class="empty-icon">ğŸ—ï¸</text>
    <text class="empty-text">æš‚æ— åäº”é¡¹é¡¹ç›®æ•°æ®</text>
  </view>
</view>

<!-- é¡¹ç›®è¯¦æƒ…å¼¹çª— -->
<view class="project-detail-modal" wx:if="{{showProjectDetail}}">
  <view class="modal-mask" bindtap="closeProjectDetail"></view>
  <view class="modal-content">
    <!-- å¼¹çª—å¤´éƒ¨ -->
    <view class="modal-header">
      <view class="modal-title">{{selectedProject.projectName}}</view>
      <view class="close-btn" bindtap="closeProjectDetail">âœ•</view>
    </view>

    <!-- é¡¹ç›®è¯¦ç»†ä¿¡æ¯ -->
    <view class="project-info-section">
      <view class="info-item">
        <view class="info-label">åºå·</view>
        <view class="info-value">{{selectedProject.serialNumber || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">åœ°çº§å¸‚</view>
        <view class="info-value">{{selectedProject.cityLevel || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">ç»“å¯¹å¿ï¼ˆå¸‚ã€åŒºï¼‰</view>
        <view class="info-value">{{selectedProject.pairedCounty || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">ç»„å›¢ç»“å¯¹é«˜æ ¡é™¢æ‰€</view>
        <view class="info-value">{{selectedProject.pairedInstitution || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">é¡¹ç›®åç§°</view>
        <view class="info-value">{{selectedProject.projectName}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">é¡¹ç›®å®æ–½å•ä½ï¼ˆé«˜æ ¡é™¢æ‰€ï¼‰</view>
        <view class="info-value">{{selectedProject.implementationUnit || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">æ˜¯å¦é‡ç‚¹é¡¹ç›®</view>
        <view class="info-value">{{selectedProject.isKeyProject || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">æ¶‰åŠå…¸å‹å¿é•‡æ‘</view>
        <view class="info-value">{{selectedProject.involvedAreas || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">é¡¹ç›®ç±»å‹</view>
        <view class="info-value">{{selectedProject.projectType}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">é¡¹ç›®å¼€å§‹æ—¶é—´</view>
        <view class="info-value">{{selectedProject.startDate || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">é¡¹ç›®ç»“æŸæ—¶é—´</view>
        <view class="info-value">{{selectedProject.endDate || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">é¡¹ç›®èƒŒæ™¯</view>
        <view class="info-value long-text">{{selectedProject.background || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">é¡¹ç›®å†…å®¹å’Œè½å®ä¸¾æª</view>
        <view class="info-value long-text">{{selectedProject.content || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">ä¸»è¦ä»»åŠ¡ç›®æ ‡</view>
        <view class="info-value long-text">{{selectedProject.objectives || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item" wx:if="{{selectedProject.contacts && selectedProject.contacts.length > 0}}">
        <view class="info-label">è”ç³»äººä¿¡æ¯</view>
        <view class="info-value">
          <view class="contact-list">
            <view class="contact-item" wx:for="{{selectedProject.contacts}}" wx:key="index">
              <text class="contact-name">{{item.name}}</text>
              <text class="contact-phone">{{item.phone}}</text>
            </view>
          </view>
        </view>
      </view>

      <view class="info-item">
        <view class="info-label">å¤‡æ³¨</view>
        <view class="info-value long-text">{{selectedProject.remarks || 'æœªè®¾ç½®'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">é¡¹ç›®è¿›åº¦</view>
        <view class="info-value">
          <view class="progress-display">
            <view class="progress-bar">
              <view class="progress-fill" style="width: {{selectedProject.progress || 0}}%"></view>
            </view>
            <text class="progress-text">{{selectedProject.progress || 0}}%</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ—¶é—´æŸ¥è¯¢æŒ‰é”®åŒºåŸŸ -->
    <view class="time-query-section">
      <view class="section-title">è¿›åº¦æŸ¥è¯¢</view>
      <view class="time-buttons">
        <view
          class="time-btn {{selectedTimeRange === item.value ? 'active' : ''}}"
          wx:for="{{timeRangeOptions}}"
          wx:key="value"
          bindtap="onTimeRangeSelect"
          data-value="{{item.value}}"
        >
          {{item.label}}
        </view>
      </view>

      <!-- è‡ªå®šä¹‰æ—¶é—´é€‰æ‹© -->
      <view class="custom-time-section">
        <view class="custom-time-row">
          <picker mode="date" value="{{customStartDate}}" bindchange="onCustomStartDateChange">
            <view class="custom-date-picker">
              <text>{{customStartDate || 'å¼€å§‹æ—¥æœŸ'}}</text>
            </view>
          </picker>
          <text class="date-separator">è‡³</text>
          <picker mode="date" value="{{customEndDate}}" bindchange="onCustomEndDateChange">
            <view class="custom-date-picker">
              <text>{{customEndDate || 'ç»“æŸæ—¥æœŸ'}}</text>
            </view>
          </picker>
          <view class="query-btn" bindtap="onCustomTimeQuery">æŸ¥è¯¢</view>
        </view>
      </view>
    </view>

    <!-- è¿›åº¦è®°å½•åŠ è½½ä¸­ -->
    <view class="progress-loading" wx:if="{{progressLoading}}">
      <text class="loading-icon">â³</text>
      <text class="loading-text">æ­£åœ¨æŸ¥è¯¢è¿›åº¦è®°å½•...</text>
    </view>

    <!-- è¿›åº¦è®°å½•åˆ—è¡¨ -->
    <view class="progress-records" wx:if="{{progressList.length > 0 && !progressLoading}}">
      <view class="records-title">è¿›åº¦è®°å½•</view>
      <view
        class="record-item"
        wx:for="{{progressList}}"
        wx:key="id"
      >
        <view class="record-summary">
          <text class="summary-person">{{item.person}}</text>
          <text class="summary-connector">äº</text>
          <text class="summary-datetime">{{item.date}} {{item.time}}</text>
          <text class="summary-connector">åœ¨</text>
          <text class="summary-location">{{item.location}}</text>
          <text class="summary-connector">è¿›è¡Œäº†ä»¥ä¸‹å·¥ä½œï¼š</text>
        </view>
        <view class="record-content">{{item.content}}</view>
      </view>
    </view>

    <!-- æ— è¿›åº¦è®°å½•æç¤º -->
    <view class="no-progress" wx:if="{{showNoProgress && !progressLoading}}">
      <text class="no-progress-icon">ğŸ“‹</text>
      <text class="no-progress-text">è¯¥æ—¶é—´æ®µæš‚æ— è¿›åº¦è®°å½•</text>
    </view>
  </view>
</view>
