<!-- 页面容器 -->
<view class="fifteen-projects-query-container">
  <!-- 搜索区域 -->
  <view class="search-section">
    <!-- 时间筛选 -->
    <view class="filter-row">
      <text class="filter-label">按项目开始时间筛选：</text>
      <picker mode="date" value="{{startDate}}" bindchange="onStartDateChange">
        <view class="date-picker">
          <text>{{startDate || '开始时间'}}</text>
        </view>
      </picker>
      <text class="date-separator">至</text>
      <picker mode="date" value="{{endDate}}" bindchange="onEndDateChange">
        <view class="date-picker">
          <text>{{endDate || '结束时间'}}</text>
        </view>
      </picker>
      <view class="clear-filter-btn" bindtap="clearTimeFilter" wx:if="{{startDate || endDate}}">
        <text class="clear-text">清除筛选</text>
      </view>
      
    </view>
    
         <!-- 筛选状态提示 -->
     <view class="filter-status" wx:if="{{startDate || endDate || searchKeyword}}">
       <text class="result-count">显示 {{projectList.length}} 条记录，共 {{allProjects.length}} 条</text>
     </view>
    
    <!-- 名称搜索 -->
    <view class="search-box">
      <text class="search-icon">🔍</text>
      <input class="search-input"
             placeholder="搜索项目名称..."
             value="{{searchKeyword}}"
             bindinput="onSearchInput"
             bindconfirm="onSearch"/>
      <view class="search-actions">
        <text class="clear-search-btn" bindtap="clearSearch" wx:if="{{searchKeyword}}">✕</text>
        <text class="search-btn" bindtap="onSearch">搜索</text>
      </view>
    </view>
  </view>

  <!-- 项目列表 -->
  <view class="project-list">
    <view
      class="project-item"
      wx:for="{{projectList}}"
      wx:key="id"
      bindtap="onProjectTap"
      data-index="{{index}}"
    >
      <!-- 项目头部 -->
      <view class="project-header">
        <view class="project-info">
          <view class="project-icon">🏗️</view>
          <view class="project-details">
            <view class="project-name">{{item.projectName}}</view>
            <view class="project-meta">
              <text class="project-start-date">开始时间：{{item.startDate || '未设置'}}</text>
            </view>
          </view>
        </view>
        <view class="project-actions">
          <view class="view-detail-btn">
            <view class="view-icon">👁️</view>
            <text class="view-text">查看详情</text>
          </view>
        </view>
      </view>

      <!-- 主要目标 -->
      <view class="project-summary">
        <view class="summary-label">主要目标：</view>
        <text class="summary-text">{{item.objectives || '暂无目标描述'}}</text>
        <view class="summary-more" wx:if="{{item.objectives && item.objectives.length > 50}}">
          <text class="more-text">点击查看完整内容</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 加载更多 -->
  <view class="load-more" wx:if="{{hasMore && !loading}}" bindtap="loadMore">
    <text>加载更多</text>
  </view>

  <!-- 加载中 -->
  <view class="loading" wx:if="{{loading}}">
    <text>加载中...</text>
  </view>

  <!-- 没有更多数据 -->
  <view class="no-more" wx:if="{{!hasMore && projectList.length > 0}}">
    <text>没有更多数据了</text>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{projectList.length === 0 && !loading}}">
    <text class="empty-icon">🏗️</text>
    <text class="empty-text">暂无十五项项目数据</text>
  </view>

  
</view>

<!-- 项目详情弹窗 -->
<view class="project-detail-modal" wx:if="{{showProjectDetail}}">
  <view class="modal-mask" bindtap="closeProjectDetail"></view>
  <view class="modal-content">
    <!-- 弹窗头部 -->
    <view class="modal-header">
      <view class="modal-title">{{selectedProject.projectName}}</view>
      <view class="close-btn" bindtap="closeProjectDetail">✕</view>
    </view>

    <!-- 项目详细信息 -->
    <view class="project-info-section">
      <view class="info-item">
        <view class="info-label">序号</view>
        <view class="info-value">{{selectedProject.serialNumber || '未设置'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">地级市</view>
        <view class="info-value">{{selectedProject.cityLevel || '未设置'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">结对县（市、区）</view>
        <view class="info-value">{{selectedProject.pairedCounty || '未设置'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">组团结对高校院所</view>
        <view class="info-value">{{selectedProject.pairedInstitution || '未设置'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">项目名称</view>
        <view class="info-value">{{selectedProject.projectName}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">项目实施单位（高校院所）</view>
        <view class="info-value">{{selectedProject.implementationUnit || '未设置'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">是否重点项目</view>
        <view class="info-value">{{selectedProject.isKeyProject || '未设置'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">涉及典型县镇村</view>
        <view class="info-value">{{selectedProject.involvedAreas || '未设置'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">项目类型</view>
        <view class="info-value">{{selectedProject.projectType}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">项目开始时间</view>
        <view class="info-value">{{selectedProject.startDate || '未设置'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">项目结束时间</view>
        <view class="info-value">{{selectedProject.endDate || '未设置'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">项目背景</view>
        <view class="info-value long-text">{{selectedProject.background || '未设置'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">项目内容和落实举措</view>
        <view class="info-value long-text">{{selectedProject.content || '未设置'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">主要任务目标</view>
        <view class="info-value long-text">{{selectedProject.objectives || '未设置'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">联系人信息</view>
        <view class="info-value">
          <!-- 有联系人数据时显示 -->
          <view class="contact-list" wx:if="{{selectedProject.contacts && selectedProject.contacts.length > 0}}">
            <view class="contact-item" wx:for="{{selectedProject.contacts}}" wx:key="index">
              <text class="contact-name">{{item.name || item.contact_name || '姓名未知'}}</text>
              <text class="contact-phone">{{item.phone || item.contact_phone || item.telephone || '电话未知'}}</text>
            </view>
          </view>
          
          <!-- 没有联系人数据时显示提示 -->
          <view class="no-contacts" wx:else>
            <text style="color: #999;">暂无联系人信息</text>
          </view>
        </view>
      </view>

      <view class="info-item">
        <view class="info-label">备注</view>
        <view class="info-value long-text">{{selectedProject.remarks || '未设置'}}</view>
      </view>

      <view class="info-item">
        <view class="info-label">项目进度</view>
        <view class="info-value">
          <view class="progress-display">
            <view class="progress-bar">
              <view class="progress-fill" style="width: {{selectedProject.progress || 0}}%"></view>
            </view>
            <text class="progress-text">{{selectedProject.progress || 0}}%</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 进度查询按钮区域 -->
    <view class="progress-query-section">
      <view class="section-title">进度查询</view>
      <view class="progress-query-btn" bindtap="onProgressQueryClick">
        <text class="btn-icon">📊</text>
        <text class="btn-text">进度查询</text>
      </view>
    </view>

    <!-- 进度记录加载中 -->
    <view class="progress-loading" wx:if="{{progressLoading}}">
      <text class="loading-icon">⏳</text>
      <text class="loading-text">正在查询进度记录...</text>
    </view>

    <!-- 进度记录列表 -->
    <view class="progress-records" wx:if="{{progressList.length > 0 && !progressLoading}}">
      <view class="records-title">进度记录</view>
      <view
        class="record-item"
        wx:for="{{progressList}}"
        wx:key="id"
      >
        <!-- 记录头部：人物和时间 -->
        <view class="record-header">
          <view class="record-person">
            <text class="person-icon">👤</text>
            <text class="person-name">{{item.person}}</text>
          </view>
          <view class="record-time">
            <text class="time-icon">🕒</text>
            <text class="time-text">{{item.date}} {{item.time}}</text>
          </view>
        </view>
        
        <!-- 地点信息 -->
        <view class="record-location" wx:if="{{item.location && item.location !== '未知地点'}}">
          <text class="location-icon">📍</text>
          <text class="location-text">{{item.location}}</text>
        </view>
        
        <!-- 工作内容 -->
        <view class="record-content">
          <text class="content-label">工作内容：</text>
          <text class="content-text">{{item.content}}</text>
        </view>
        
        <!-- 多媒体资源区域 -->
        <view class="record-media" wx:if="{{item.originalData.practice_image_url || item.originalData.practice_video_url || item.originalData.news}}">
          <view class="media-title">相关资源</view>
          
          <!-- 图片展示 -->
          <view class="record-images" wx:if="{{item.originalData.practice_image_url}}">
            <view class="media-section">
              <text class="media-label">📷 现场图片</text>
              <view class="image-grid">
                <view class="image-item" wx:for="{{item.originalData.practice_image_url.split(',')}}" wx:key="index" wx:for-item="imageUrl">
                  <image 
                    src="{{imageUrl.trim()}}" 
                    mode="aspectFill" 
                    class="progress-image"
                    bindtap="previewImage"
                    data-urls="{{item.originalData.practice_image_url.split(',')}}"
                    data-current="{{imageUrl.trim()}}"
                  />
                </view>
              </view>
            </view>
          </view>
          
          <!-- 视频展示 -->
          <view class="record-video" wx:if="{{item.originalData.practice_video_url}}">
            <view class="media-section">
              <text class="media-label">🎥 现场视频</text>
              <view class="video-item">
                <video 
                  src="{{item.originalData.practice_video_url}}" 
                  class="progress-video"
                  controls
                  show-center-play-btn
                  show-play-btn
                  show-fullscreen-btn
                />
              </view>
            </view>
          </view>
          
          <!-- 文件/新闻链接 -->
          <view class="record-files" wx:if="{{item.originalData.news}}">
            <view class="media-section">
              <text class="media-label">📄 相关文件</text>
              <view class="file-item">
                <text class="file-icon">📋</text>
                <text class="file-name">{{item.originalData.news}}</text>
                <view class="file-actions">
                  <view class="view-btn" bindtap="viewFile" data-url="{{item.originalData.news}}">查看</view>
                  <view class="download-btn" bindtap="downloadFile" data-url="{{item.originalData.news}}">下载</view>
                </view>
              </view>
            </view>
          </view>
        </view>
        
        <!-- 记录底部：操作按钮 -->
        <view class="record-actions">
          <view class="action-btn" bindtap="shareRecord" data-record="{{item}}">
            <text class="action-icon">📤</text>
            <text class="action-text">分享</text>
          </view>
          <view class="action-btn" bindtap="exportRecord" data-record="{{item}}">
            <text class="action-icon">📥</text>
            <text class="action-text">导出</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 无进度记录提示 -->
    <view class="no-progress" wx:if="{{showNoProgress && !progressLoading}}">
      <text class="no-progress-icon">📋</text>
      <text class="no-progress-text">该时间段暂无进度记录</text>
    </view>
  </view>
</view>

