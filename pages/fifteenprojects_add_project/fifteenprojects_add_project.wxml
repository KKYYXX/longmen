<view class="add-project-container">
  <view class="page-header">
    <text class="page-title">新增项目</text>
    <text class="page-subtitle">填写各列的内容</text>
  </view>

  <view class="form-container">
    <!-- 动态生成表单项 -->
    <view class="form-section">
      <text class="section-title">项目信息</text>

      <view
        class="form-item"
        wx:for="{{projectColumns}}"
        wx:key="key"
      >
        <text class="form-label">
          {{item.name}}
          <text wx:if="{{item.required}}" class="required-mark">*</text>
        </text>

        <!-- 文本输入 -->
        <input
          wx:if="{{item.type === 'text'}}"
          class="form-input"
          placeholder="{{item.placeholder}}"
          value="{{projectData[item.key]}}"
          bindinput="onFieldInput"
          data-field="{{item.key}}"
        />

        <!-- 多行文本输入 -->
        <textarea
          wx:if="{{item.type === 'textarea'}}"
          class="form-textarea"
          placeholder="{{item.placeholder}}"
          value="{{projectData[item.key]}}"
          bindinput="onFieldInput"
          data-field="{{item.key}}"
          maxlength="1000"
        />

        <!-- 日期选择 -->
        <picker
          wx:if="{{item.type === 'date'}}"
          class="form-picker"
          mode="date"
          value="{{projectData[item.key]}}"
          bindchange="onPickerChange"
          data-field="{{item.key}}"
        >
          <view class="picker-display">
            {{projectData[item.key] || item.placeholder}}
          </view>
        </picker>

        <!-- 选择器 -->
        <picker
          wx:if="{{item.type === 'select'}}"
          class="form-picker"
          bindchange="onPickerChange"
          range="{{item.options}}"
          data-field="{{item.key}}"
        >
          <view class="picker-display">
            {{projectData[item.key] || '请选择' + item.name}}
          </view>
        </picker>

        <!-- 滑块 -->
        <view wx:if="{{item.type === 'slider'}}" class="slider-container">
          <slider
            class="form-slider"
            value="{{projectData[item.key]}}"
            min="{{item.min || 0}}"
            max="{{item.max || 100}}"
            step="1"
            show-value
            bindchange="onSliderChange"
            data-field="{{item.key}}"
          />
          <text class="slider-unit">{{item.unit || ''}}</text>
        </view>

        <!-- 联系人管理 -->
        <view wx:if="{{item.type === 'contacts'}}" class="contacts-container">
          <!-- 联系人列表 -->
          <view wx:if="{{contacts.length > 0}}" class="contacts-list">
            <view
              class="contact-item"
              wx:for="{{contacts}}"
              wx:key="index"
            >
              <view class="contact-info">
                <text class="contact-name">{{item.name}}</text>
                <text class="contact-phone">{{item.phone}}</text>
              </view>
              <view class="contact-actions">
                <text
                  class="contact-edit-btn"
                  bindtap="showEditContactModal"
                  data-index="{{index}}"
                >编辑</text>
                <text
                  class="contact-delete-btn"
                  bindtap="deleteContact"
                  data-index="{{index}}"
                >删除</text>
              </view>
            </view>
          </view>

          <!-- 添加联系人按钮 -->
          <view class="add-contact-btn" bindtap="showAddContactModal">
            <text class="add-contact-icon">+</text>
            <text class="add-contact-text">添加联系人</text>
          </view>
        </view>
      </view>
    </view>



    <view class="button-group">
      <button class="save-btn" bindtap="saveProject">保存项目</button>
      <button class="cancel-btn" bindtap="cancel">取消</button>
    </view>
  </view>
</view>

<!-- 联系人弹窗 -->
<view class="contact-modal" wx:if="{{showContactModal}}">
  <view class="contact-modal-mask" bindtap="closeContactModal"></view>
  <view class="contact-modal-content">
    <view class="contact-modal-header">
      <text class="contact-modal-title">
        {{editingContactIndex >= 0 ? '编辑联系人' : '添加联系人'}}
      </text>
      <text class="contact-modal-close" bindtap="closeContactModal">✕</text>
    </view>

    <view class="contact-modal-body">
      <view class="contact-form-item">
        <text class="contact-form-label">姓名 *</text>
        <input
          class="contact-form-input"
          placeholder="请输入联系人姓名"
          value="{{currentContact.name}}"
          bindinput="onContactNameInput"
        />
      </view>

      <view class="contact-form-item">
        <text class="contact-form-label">联系方式 *</text>
        <input
          class="contact-form-input"
          placeholder="请输入手机号或其他联系方式"
          value="{{currentContact.phone}}"
          bindinput="onContactPhoneInput"
        />
      </view>
    </view>

    <view class="contact-modal-footer">
      <button class="contact-cancel-btn" bindtap="closeContactModal">取消</button>
      <button class="contact-save-btn" bindtap="saveContact">保存</button>
    </view>
  </view>
</view>
