<view class="progress-container">
  <view class="texture-overlay"></view>
  <view class="light-spot"></view>
  
  <!-- å¤´éƒ¨å¯¼èˆª -->
  <view class="header">
    <view class="back-btn" bindtap="navigateBack">
      <text class="back-icon">â†</text>
    </view>
    <view class="title-box">
      <text class="title">{{projectData.projectName}}</text>
      <text class="subtitle">é¡¹ç›®è¿›åº¦è¯¦æƒ…</text>
    </view>
    <view class="header-actions">
      <view class="action-btn" bindtap="goToDeletePage">
        <text class="action-icon">ğŸ—‘ï¸</text>
      </view>
      <view class="share-btn" bindtap="shareProject">
        <text class="share-icon">â‹¯</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- é¡¹ç›®å†…å®¹ -->
  <view class="main-content" wx:if="{{!loading && projectData}}">
    
    <!-- ä¸»è¦ä»»åŠ¡ç›®æ ‡å¡ç‰‡ -->
    <view class="objectives-card">
      <view class="card-header">
        <text class="card-title">ğŸ¯ ä¸»è¦ä»»åŠ¡ç›®æ ‡</text>
      </view>
      <view class="objectives-content">
        <text class="objectives-text">{{projectData.objectives || 'æš‚æ— ä»»åŠ¡ç›®æ ‡æè¿°'}}</text>
      </view>
      
      <!-- é¡¹ç›®åŸºæœ¬ä¿¡æ¯ -->
      <view class="project-info">
        <view class="info-row">
          <view class="info-item">
            <text class="info-label">é¡¹ç›®ç±»å‹</text>
            <text class="info-value">{{projectData.projectType || 'æš‚æ— '}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">æ€»è¿›åº¦</text>
            <text class="info-value">{{projectData.progress || 0}}%</text>
          </view>
        </view>
        <view class="info-row">
          <view class="info-item">
            <text class="info-label">å¼€å§‹æ—¶é—´</text>
            <text class="info-value">{{projectData.startDate || 'æš‚æ— '}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">é¢„è®¡å®Œæˆ</text>
            <text class="info-value">{{projectData.endDate || 'æš‚æ— '}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- è¿›åº¦æ—¶é—´çº¿ -->
    <view class="timeline-section">
      <view class="section-header">
        <text class="section-title">ğŸ“… é¡¹ç›®è¿›åº¦æ—¶é—´çº¿</text>
        <text class="section-subtitle">ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†è¿›åº¦</text>
      </view>

      <!-- æ—¶é—´ç­›é€‰å™¨ -->
      <view class="time-filter">
        <view class="filter-buttons">
          <view class="filter-btn {{timeFilter === 'week' ? 'active' : ''}}" bindtap="filterByTime" data-filter="week">
            <text>æœ€è¿‘ä¸€å‘¨</text>
          </view>
          <view class="filter-btn {{timeFilter === 'month' ? 'active' : ''}}" bindtap="filterByTime" data-filter="month">
            <text>æœ€è¿‘ä¸€æœˆ</text>
          </view>
          <view class="filter-btn {{timeFilter === 'year' ? 'active' : ''}}" bindtap="filterByTime" data-filter="year">
            <text>æœ€è¿‘ä¸€å¹´</text>
          </view>
          <view class="filter-btn {{timeFilter === 'all' ? 'active' : ''}}" bindtap="filterByTime" data-filter="all">
            <text>æŸ¥çœ‹å…¨éƒ¨</text>
          </view>
        </view>

        <picker mode="date" value="{{selectedDate}}" bindchange="onDateChange">
          <view class="date-picker-btn">
            <text class="picker-icon">ğŸ“…</text>
            <text class="picker-text">{{selectedDate || 'é€‰æ‹©å…·ä½“æ—¥æœŸ'}}</text>
            <text class="picker-arrow">â–¼</text>
          </view>
        </picker>
      </view>

      <!-- è¿›åº¦åˆ—è¡¨ -->
      <view class="progress-list">
        <view 
          class="progress-item {{item.isToday ? 'today' : ''}}" 
          wx:for="{{filteredProgressList}}" 
          wx:key="id"
          bindtap="viewProgressDetail"
          data-progress="{{item}}"
        >
          <view class="progress-time">
            <view class="time-dot {{item.status}}"></view>
            <view class="time-info">
              <text class="time-date">{{item.date}}</text>
              <text class="time-period">{{item.time}}</text>
            </view>
          </view>
          
          <view class="progress-content">
            <view class="progress-header">
              <text class="progress-title">{{item.title}}</text>
              <view class="progress-actions">
                <text class="progress-status {{item.status}}">{{item.statusText}}</text>
                <view class="delete-btn" bindtap="deleteProgress" data-id="{{item.id}}" catchtap="deleteProgress">
                  <text class="delete-icon">ğŸ—‘ï¸</text>
                </view>
              </view>
            </view>
            
            <view class="progress-details">
              <view class="detail-item">
                <text class="detail-icon">ğŸ“</text>
                <text class="detail-text">{{item.location}}</text>
              </view>
              <view class="detail-item">
                <text class="detail-icon">ğŸ‘¤</text>
                <text class="detail-text">{{item.person}}</text>
              </view>
              <view class="detail-item">
                <text class="detail-icon">ğŸ“</text>
                <text class="detail-text">{{item.description}}</text>
              </view>
            </view>

            <!-- è¿›åº¦å›¾ç‰‡ -->
            <view class="progress-images" wx:if="{{item.images && item.images.length > 0}}">
              <image 
                class="progress-image" 
                wx:for="{{item.images}}" 
                wx:for-item="img"
                wx:key="*this"
                src="{{img}}"
                mode="aspectFill"
                bindtap="previewImage"
                data-src="{{img}}"
                data-urls="{{item.images}}"
              />
            </view>

            <!-- å®Œæˆåº¦ -->
            <view class="completion-info" wx:if="{{item.completion}}">
              <text class="completion-label">å®Œæˆåº¦ï¼š</text>
              <view class="completion-bar">
                <view class="completion-fill" style="width: {{item.completion}}%"></view>
              </view>
              <text class="completion-text">{{item.completion}}%</text>
            </view>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-progress" wx:if="{{filteredProgressList.length === 0 && !loading}}">
        <text class="empty-icon">ğŸ“…</text>
        <text class="empty-text">{{selectedDate ? 'è¯¥æ—¥æœŸæš‚æ— è¿›åº¦è®°å½•' : 'æš‚æ— è¿›åº¦è®°å½•'}}</text>
        <text class="empty-hint">é¡¹ç›®è¿›åº¦å°†å®æ—¶æ›´æ–°æ˜¾ç¤º</text>
      </view>
    </view>

    <!-- é¡¹ç›®ç»Ÿè®¡ -->
    <view class="stats-section">
      <view class="section-header">
        <text class="section-title">ğŸ“Š é¡¹ç›®ç»Ÿè®¡</text>
      </view>
      
      <view class="stats-grid">
        <view class="stat-item">
          <text class="stat-number">{{progressStats.totalRecords}}</text>
          <text class="stat-label">æ€»è®°å½•æ•°</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{progressStats.completedTasks}}</text>
          <text class="stat-label">å·²å®Œæˆä»»åŠ¡</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{progressStats.ongoingTasks}}</text>
          <text class="stat-label">è¿›è¡Œä¸­ä»»åŠ¡</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{progressStats.pendingTasks}}</text>
          <text class="stat-label">å¾…å¼€å§‹ä»»åŠ¡</text>
        </view>
      </view>
    </view>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-container" wx:if="{{!loading && !projectData}}">
    <text class="error-icon">âŒ</text>
    <text class="error-title">åŠ è½½å¤±è´¥</text>
    <text class="error-desc">æ— æ³•è·å–é¡¹ç›®è¯¦æƒ…ï¼Œè¯·é‡è¯•</text>
    <text class="retry-btn" bindtap="loadProjectData">é‡æ–°åŠ è½½</text>
  </view>
</view>
