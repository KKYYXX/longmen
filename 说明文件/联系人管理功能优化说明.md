# 联系人管理功能优化说明

## 优化目标

根据用户需求，对十五项项目添加页面的联系人部分进行优化：
1. 去掉"联系人职务"一栏
2. 将"联系人姓名"和"联系方式"合并为一个"联系人信息"栏
3. 在合并后的栏目中添加联系人管理功能，支持添加多个联系人

## 修改内容

### 1. 数据结构调整

**文件**：`pages/fifteenprojects_add_project/fifteenprojects_add_project.js`

#### 1.1 项目字段配置
**修改前**：
```javascript
{ name: '联系人姓名', key: 'contactName', type: 'text', required: false, placeholder: '请输入联系人姓名' },
{ name: '联系人职务', key: 'contactPosition', type: 'text', required: false, placeholder: '请输入联系人职务' },
{ name: '联系方式', key: 'contactPhone', type: 'text', required: false, placeholder: '请输入联系方式' },
```

**修改后**：
```javascript
{ name: '联系人信息', key: 'contacts', type: 'contacts', required: false, placeholder: '添加联系人' },
```

#### 1.2 数据字段新增
```javascript
data: {
  // 原有字段...
  // 联系人相关数据
  contacts: [],                    // 联系人列表
  showContactModal: false,         // 是否显示联系人弹窗
  currentContact: {                // 当前编辑的联系人
    name: '',
    phone: ''
  },
  editingContactIndex: -1          // 正在编辑的联系人索引（-1表示新增）
}
```

### 2. 联系人管理功能

#### 2.1 新增的方法

**显示添加联系人弹窗**：
```javascript
showAddContactModal() {
  this.setData({
    showContactModal: true,
    currentContact: { name: '', phone: '' },
    editingContactIndex: -1
  });
}
```

**显示编辑联系人弹窗**：
```javascript
showEditContactModal(e) {
  const index = e.currentTarget.dataset.index;
  const contact = this.data.contacts[index];
  this.setData({
    showContactModal: true,
    currentContact: { name: contact.name, phone: contact.phone },
    editingContactIndex: index
  });
}
```

**保存联系人**：
```javascript
saveContact() {
  // 验证输入
  // 保存或更新联系人
  // 更新项目数据
  // 关闭弹窗并显示成功提示
}
```

**删除联系人**：
```javascript
deleteContact(e) {
  // 显示确认对话框
  // 删除指定联系人
  // 更新项目数据
}
```

### 3. 用户界面优化

**文件**：`pages/fifteenprojects_add_project/fifteenprojects_add_project.wxml`

#### 3.1 联系人列表显示
```xml
<!-- 联系人管理 -->
<view wx:if="{{item.type === 'contacts'}}" class="contacts-container">
  <!-- 联系人列表 -->
  <view wx:if="{{contacts.length > 0}}" class="contacts-list">
    <view class="contact-item" wx:for="{{contacts}}" wx:key="index">
      <view class="contact-info">
        <text class="contact-name">{{item.name}}</text>
        <text class="contact-phone">{{item.phone}}</text>
      </view>
      <view class="contact-actions">
        <text class="contact-edit-btn" bindtap="showEditContactModal" data-index="{{index}}">编辑</text>
        <text class="contact-delete-btn" bindtap="deleteContact" data-index="{{index}}">删除</text>
      </view>
    </view>
  </view>
  
  <!-- 添加联系人按钮 -->
  <view class="add-contact-btn" bindtap="showAddContactModal">
    <text class="add-contact-icon">+</text>
    <text class="add-contact-text">添加联系人</text>
  </view>
</view>
```

#### 3.2 联系人编辑弹窗
```xml
<!-- 联系人弹窗 -->
<view class="contact-modal" wx:if="{{showContactModal}}">
  <view class="contact-modal-mask" bindtap="closeContactModal"></view>
  <view class="contact-modal-content">
    <view class="contact-modal-header">
      <text class="contact-modal-title">
        {{editingContactIndex >= 0 ? '编辑联系人' : '添加联系人'}}
      </text>
      <text class="contact-modal-close" bindtap="closeContactModal">✕</text>
    </view>
    
    <view class="contact-modal-body">
      <view class="contact-form-item">
        <text class="contact-form-label">姓名 *</text>
        <input class="contact-form-input" placeholder="请输入联系人姓名" 
               value="{{currentContact.name}}" bindinput="onContactNameInput" />
      </view>
      
      <view class="contact-form-item">
        <text class="contact-form-label">联系方式 *</text>
        <input class="contact-form-input" placeholder="请输入手机号或其他联系方式" 
               value="{{currentContact.phone}}" bindinput="onContactPhoneInput" />
      </view>
    </view>
    
    <view class="contact-modal-footer">
      <button class="contact-cancel-btn" bindtap="closeContactModal">取消</button>
      <button class="contact-save-btn" bindtap="saveContact">保存</button>
    </view>
  </view>
</view>
```

### 4. 样式设计

**文件**：`pages/fifteenprojects_add_project/fifteenprojects_add_project.wxss`

#### 4.1 联系人列表样式
- **联系人卡片**：灰色背景，圆角边框，清晰的层次感
- **联系人信息**：姓名加粗显示，联系方式较小字体
- **操作按钮**：编辑按钮蓝色，删除按钮红色，有悬停效果

#### 4.2 添加按钮样式
- **虚线边框**：蓝色虚线边框，表示可点击添加
- **图标和文字**：加号图标 + "添加联系人"文字
- **交互效果**：点击时有缩放动画

#### 4.3 弹窗样式
- **遮罩层**：半透明黑色背景
- **弹窗内容**：白色背景，圆角，阴影效果
- **表单样式**：现代化的输入框设计，聚焦时高亮

### 5. 数据兼容性处理

#### 5.1 保存时的数据转换
```javascript
// 构建提交数据
const submitData = {
  ...projectData,
  createDate: new Date().toISOString().split('T')[0],
  // 确保联系人数据被包含
  contacts: this.data.contacts || []
};

// 为了兼容性，如果有联系人，设置第一个联系人为主要联系人
if (this.data.contacts && this.data.contacts.length > 0) {
  const primaryContact = this.data.contacts[0];
  submitData.contactName = primaryContact.name;
  submitData.contactPhone = primaryContact.phone;
  submitData.contactPosition = ''; // 职务字段已移除，设为空
}
```

#### 5.2 初始化时的数据处理
```javascript
onLoad() {
  const projectData = {};
  this.data.projectColumns.forEach(column => {
    if (column.type === 'slider') {
      projectData[column.key] = 0;
    } else if (column.type === 'contacts') {
      projectData[column.key] = [];  // 联系人字段初始化为空数组
    } else {
      projectData[column.key] = '';
    }
  });
  this.setData({ projectData });
}
```

## 功能特性

### ✅ 新增功能

1. **多联系人支持**：
   - 可以添加多个联系人
   - 每个联系人包含姓名和联系方式
   - 支持编辑和删除操作

2. **直观的用户界面**：
   - 联系人以卡片形式展示
   - 清晰的添加按钮
   - 模态弹窗编辑体验

3. **数据验证**：
   - 姓名和联系方式为必填项
   - 输入验证和错误提示
   - 重复操作确认

4. **兼容性保证**：
   - 保存时自动设置主要联系人字段
   - 向后兼容原有数据结构
   - 平滑的数据迁移

### ❌ 移除功能

1. **联系人职务字段**：
   - 不再收集职务信息
   - 简化联系人数据结构
   - 专注于核心联系信息

### 🔄 优化功能

1. **联系人管理**：
   - 从单一联系人升级为多联系人管理
   - 更灵活的联系人信息维护
   - 更好的用户体验

## 使用指南

### 添加联系人
1. 在"联系人信息"栏点击"添加联系人"按钮
2. 在弹窗中输入姓名和联系方式
3. 点击"保存"按钮完成添加

### 编辑联系人
1. 点击联系人卡片右侧的"编辑"按钮
2. 在弹窗中修改姓名或联系方式
3. 点击"保存"按钮完成修改

### 删除联系人
1. 点击联系人卡片右侧的"删除"按钮
2. 在确认对话框中点击"确定"
3. 联系人将被从列表中移除

## 技术实现

### 数据流程
```
用户操作 → 弹窗显示 → 数据验证 → 更新状态 → 界面刷新 → 保存到项目数据
```

### 状态管理
- `contacts`：联系人列表数组
- `showContactModal`：控制弹窗显示/隐藏
- `currentContact`：当前编辑的联系人数据
- `editingContactIndex`：区分新增(-1)和编辑(>=0)模式

### 事件处理
- `showAddContactModal`：显示新增联系人弹窗
- `showEditContactModal`：显示编辑联系人弹窗
- `saveContact`：保存联系人数据
- `deleteContact`：删除联系人
- `closeContactModal`：关闭弹窗

## 总结

通过这次优化：

1. **简化了数据结构**：去掉了不必要的职务字段
2. **增强了功能性**：支持多联系人管理
3. **改善了用户体验**：直观的界面和流畅的操作
4. **保证了兼容性**：向后兼容原有数据格式
5. **提升了可维护性**：清晰的代码结构和完善的错误处理

现在用户可以更方便地管理项目联系人信息，支持添加多个联系人，并且界面更加现代化和易用！🎉
