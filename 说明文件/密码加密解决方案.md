# 密码加密解决方案

## 问题描述
当数据库中的密码使用了哈希加密（如MD5、SHA256等），而前端直接传输明文密码时，会导致验证失败。

## 解决方案

### 方案一：前端哈希加密（已实现）

#### 1. 加密工具文件
- 文件：`utils/crypto.js`
- 功能：提供密码加密和验证功能
- 方法：
  - `encryptPassword(password)` - 加密密码
  - `verifyPassword(inputPassword, storedPassword)` - 验证密码

#### 2. 修改登录逻辑
- 在 `pages/personal/personal.js` 中引入加密工具
- 登录时对输入的密码进行加密
- 与数据库中存储的加密密码进行比较

#### 3. 修改注册逻辑
- 注册时对密码进行加密存储
- 确保数据库中存储的是加密后的密码

### 方案二：后端API验证（推荐）

#### 1. API工具文件
- 文件：`utils/api.js`
- 功能：与后端API通信
- 方法：
  - `login(loginData)` - 登录API
  - `register(registerData)` - 注册API

#### 2. 后端处理流程
```javascript
// 后端伪代码
function login(identifier, password) {
  // 1. 根据identifier查找用户
  const user = findUser(identifier);
  
  // 2. 对输入的密码进行哈希加密
  const hashedPassword = hashPassword(password);
  
  // 3. 比较加密后的密码
  if (user.password === hashedPassword) {
    return { success: true, user };
  } else {
    return { success: false, message: '密码错误' };
  }
}
```

### 方案三：使用微信小程序内置加密

#### 1. 使用微信小程序的加密API
```javascript
// 使用微信小程序的加密功能
wx.request({
  url: 'your-api-url',
  method: 'POST',
  data: {
    password: password // 明文密码，由后端处理加密
  }
});
```

## 推荐方案

### 开发环境
- 使用 **方案一**：前端哈希加密
- 优点：简单快速，无需后端
- 缺点：安全性相对较低

### 生产环境
- 使用 **方案二**：后端API验证
- 优点：安全性高，符合最佳实践
- 缺点：需要后端支持

## 实施步骤

### 1. 立即实施（方案一）
1. ✅ 已创建 `utils/crypto.js` 加密工具
2. ✅ 已修改 `pages/personal/personal.js` 登录逻辑
3. ✅ 已修改注册逻辑

### 2. 测试验证
1. 注册新用户，检查密码是否加密存储
2. 使用注册的账号登录，验证是否成功
3. 检查数据库中存储的密码是否为加密形式

### 3. 生产环境升级（方案二）
1. 搭建后端API服务
2. 修改前端代码，使用API通信
3. 实现后端密码加密和验证逻辑

## 安全建议

1. **使用HTTPS**：确保API通信安全
2. **加盐哈希**：在密码哈希时添加随机盐值
3. **限制登录尝试**：防止暴力破解
4. **定期更新密码**：建议用户定期更换密码
5. **多因素认证**：考虑添加短信验证码等

## 测试用例

### 测试1：注册功能
```javascript
// 注册用户：张三，手机号：13800138000，密码：Test123
// 预期结果：密码在数据库中显示为加密形式
```

### 测试2：登录功能
```javascript
// 使用上述账号登录
// 预期结果：登录成功，跳转到对应页面
```

### 测试3：密码验证
```javascript
// 使用错误密码登录
// 预期结果：显示"密码错误"提示
``` 