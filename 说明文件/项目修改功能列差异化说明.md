# 项目修改功能列差异化说明

## 修改概述

根据用户需求，修改了项目修改功能，让不同的列显示不同的修改选项和界面：

1. **所有列**都保留"修改内容"和"添加内容"功能
2. **只有"项目进度"列**才显示"删除内容"选项
3. **"添加内容"功能**根据不同列的实际情况设置不同的添加界面

## 主要修改内容

### 1. 步骤3：选择操作类型的差异化

**项目进度列显示的选项：**
- ✏️ 修改内容 - 修改项目进度信息
- 📎 添加内容 - 添加图片、视频、时间、地点、人员等
- 🗑️ 删除内容 - 删除项目进度记录

**其他列显示的选项：**
- ✏️ 修改内容 - 根据列类型显示相应描述
- 📎 添加内容 - 根据列类型显示不同的添加选项
  - 联系人信息列：添加联系人信息
  - 涉及典型县镇村列：添加区域信息
  - 多行文本列：添加补充说明
  - 其他列：添加相应信息

### 2. 步骤4：修改内容的差异化界面

#### 项目进度列的修改界面
保持原有的复杂界面：
- 时间筛选功能（最近一周/一月/一年/查看全部）
- 自定义日期选择
- 统计信息显示
- 进度记录列表选择
- 进入详细修改页面

#### 其他列的修改界面
提供简化的直接修改界面：

**当前内容显示区域：**
- 显示该列的当前值
- 灰色背景，只读显示

**新内容输入区域：**
根据列的类型显示不同的输入控件：

1. **textarea类型列**（项目背景、项目内容和落实举措、主要任务目标、备注）：
   - 显示多行文本框
   - 最大长度1000字符

2. **日期类型列**（项目开始时间、项目结束时间）：
   - 显示日期选择器
   - 点击可选择日期

3. **是否重点项目列**：
   - 显示单选按钮组
   - 选项：是/否

4. **其他文本类型列**：
   - 显示单行输入框
   - 适用于序号、地级市、结对县等

**操作按钮：**
- 确认修改按钮（需要输入内容才能点击）
- 上一步按钮

#### 其他列的添加界面
根据不同列类型提供相应的添加功能：

1. **联系人信息列**：
   - 添加联系人信息
   - 格式：姓名:电话号码
   - 多个联系人用分号分隔

2. **涉及典型县镇村列**：
   - 添加区域信息
   - 多个区域用逗号分隔

3. **多行文本类型列**：
   - 添加补充说明
   - 新内容换行追加到原内容后

4. **其他文本类型列**：
   - 添加相应信息
   - 多个信息用分号分隔

## 技术实现细节

### 1. WXML模板修改

```xml
<!-- 步骤3中根据列类型显示不同选项 -->
<view wx:if="{{selectedColumn.key === 'progress'}}" ...>
  <!-- 项目进度列的选项 -->
</view>

<!-- 步骤4中根据列类型显示不同界面 -->
<view wx:if="{{selectedColumn.key === 'progress'}}">
  <!-- 项目进度的复杂修改界面 -->
</view>
<view wx:else>
  <!-- 其他列的简单修改界面 -->
</view>
```

### 2. JavaScript逻辑修改

**新增函数：**
- `getCurrentColumnValue(project, columnKey)` - 获取当前列的值
- `onNewContentInput(e)` - 处理新内容输入
- `onDatePickerChange(e)` - 处理日期选择
- `selectKeyProject(e)` - 处理是否重点项目选择
- `confirmSimpleModify()` - 确认简单修改

**修改的函数：**
- `selectColumn(e)` - 选择列时更新当前列值
- `selectAction(e)` - 选择操作时预填充当前值（非项目进度列）
- `nextStep()` - 只在项目进度列时加载进度数据

### 3. 数据结构修改

**新增数据属性：**
- `currentColumnValue` - 存储当前选择列的值

## 列类型对应的修改界面

| 列名 | 列键 | 类型 | 修改界面 | 添加界面 | 删除功能 |
|------|------|------|----------|----------|----------|
| 序号 | serialNumber | text | 单行输入框 | 简单文本添加 | ❌ |
| 地级市 | cityLevel | text | 单行输入框 | 简单文本添加 | ❌ |
| 结对县（市、区） | pairedCounty | text | 单行输入框 | 简单文本添加 | ❌ |
| 组团结对高校院所 | pairedInstitution | text | 单行输入框 | 简单文本添加 | ❌ |
| 项目名称 | projectName | text | 单行输入框 | 简单文本添加 | ❌ |
| 项目实施单位 | implementationUnit | text | 单行输入框 | 简单文本添加 | ❌ |
| 是否重点项目 | isKeyProject | text | 单选按钮 | 简单文本添加 | ❌ |
| 涉及典型县镇村 | involvedAreas | text | 单行输入框 | 区域信息添加 | ❌ |
| 项目类型 | projectType | text | 单行输入框 | 简单文本添加 | ❌ |
| 项目开始时间 | startDate | text | 日期选择器 | 简单文本添加 | ❌ |
| 项目结束时间 | endDate | text | 日期选择器 | 简单文本添加 | ❌ |
| 项目背景 | background | textarea | 多行文本框 | 补充说明添加 | ❌ |
| 项目内容和落实举措 | content | textarea | 多行文本框 | 补充说明添加 | ❌ |
| 主要任务目标 | objectives | textarea | 多行文本框 | 补充说明添加 | ❌ |
| 联系人信息 | contacts | text | 单行输入框 | 联系人信息添加 | ❌ |
| 备注 | remarks | textarea | 多行文本框 | 补充说明添加 | ❌ |
| **项目进度** | **progress** | **text** | **复杂界面** | **图片视频等添加** | **✅** |

## 用户体验改进

1. **操作选项差异化**：
   - 项目进度列：修改内容 + 添加内容（图片视频等） + 删除内容
   - 其他列：修改内容 + 添加内容（根据列类型）

2. **界面差异化**：不同类型的列显示最适合的输入控件

3. **当前值显示**：修改时可以看到当前值，避免误操作

4. **预填充功能**：修改时自动填入当前值，方便用户编辑

5. **添加功能智能化**：根据列的实际用途提供相应的添加功能

## 测试建议

1. **测试项目进度列**：
   - 确保仍能正常添加图片视频和删除记录
   - 确保修改功能正常工作

2. **测试其他列的修改功能**：
   - 文本列：确保能正常修改文本内容
   - 日期列：确保日期选择器正常工作
   - 是否重点项目列：确保单选按钮正常工作
   - textarea列：确保多行文本框正常工作

3. **测试其他列的添加功能**：
   - 联系人信息列：测试联系人格式添加
   - 涉及典型县镇村列：测试区域信息添加
   - 多行文本列：测试补充说明添加
   - 其他列：测试简单文本添加

4. **确认界面显示**：
   - 确认只有项目进度列显示删除选项
   - 确认所有列都显示修改和添加选项

## 注意事项

1. **API调用**：
   - 修改后的数据需要调用后端API保存
   - 需要在confirmSimpleModify和saveSimpleAddition函数中添加实际的API调用

2. **输入验证**：
   - 建议添加输入验证，如日期格式验证、必填字段验证等
   - 联系人信息格式验证（姓名:电话）

3. **业务逻辑**：
   - 可能需要根据实际业务需求调整某些列的输入控件类型
   - 添加内容的分隔符可能需要根据实际需求调整

4. **用户体验**：
   - 考虑添加保存成功后的数据刷新
   - 考虑添加撤销功能
