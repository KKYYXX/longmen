# 负责人转让功能实现说明

## 功能概述

本功能实现了负责人权限的转让，包括以下流程：
1. 在"当前负责人"页面点击"转让"按钮
2. 跳转到"被转让人信息"页面
3. 填写被转让人的姓名、手机号、微信号
4. 点击"确认转让"按钮调用后端接口
5. 根据接口返回结果决定转让是否成功

## 页面结构

### 1. 当前负责人页面 (`pages/当前负责人/当前负责人`)
- **功能**: 显示当前负责人信息，提供转让按钮
- **关键代码**: 
  - 显示负责人姓名和手机号
  - 点击转让按钮跳转到被转让人页面，并传递当前负责人手机号

### 2. 被转让人信息页面 (`pages/被转让人信息/被转让人信息`)
- **功能**: 填写被转让人信息，调用转让接口
- **关键代码**:
  - 表单验证（姓名、手机号、微信号）
  - 调用后端 `/user/transfer_principal` 接口
  - 处理转让成功/失败的结果

## 接口对接

### 后端接口
```
POST /user/transfer_principal
```

### 请求参数
- `name`: 被转让人姓名
- `phone`: 被转让人手机号  
- `wx_openid`: 被转让人微信号
- `current_phone`: 当前负责人手机号

### 响应处理
- **成功 (200)**: 显示"转让成功"提示，返回上一页
- **失败 (400/403/404/500)**: 显示具体错误信息

## 数据流程

1. **当前负责人页面** → 传递当前负责人手机号 → **被转让人页面**
2. **被转让人页面** → 收集表单数据 → **后端接口**
3. **后端接口** → 验证并执行转让 → **返回结果**
4. **前端** → 根据结果显示相应提示

## 关键修改点

### 1. 被转让人信息页面 (`被转让人信息.js`)
- 添加 `currentManagerPhone` 数据字段
- 修改 `callTransferAPI` 方法调用正确的接口
- 在 `onLoad` 中接收当前负责人手机号参数

### 2. 当前负责人页面 (`当前负责人.js`)
- 修改 `onTransfer` 方法，在跳转时传递当前负责人手机号

## 测试步骤

1. 进入"当前负责人"页面
2. 点击"转让"按钮
3. 在"被转让人信息"页面填写信息：
   - 姓名：被转让人的真实姓名
   - 电话：被转让人的手机号
   - 微信号：被转让人的微信号
4. 点击"确认转让"按钮
5. 观察转让结果

## 注意事项

1. **信息验证**: 后端会验证被转让人信息是否与数据库中的记录匹配
2. **权限检查**: 只有当前负责人才能进行转让操作
3. **重复转让**: 已经是负责人的用户不能再次被转让
4. **网络处理**: 接口调用失败时会显示网络错误提示

## 错误处理

- **信息不完整**: 提示"请完善信息"
- **用户不存在**: 提示"被转让用户不存在"
- **信息不匹配**: 提示"被转让用户信息有误，请确认"
- **已是负责人**: 提示"该用户已是负责人，不能转让"
- **无权限**: 提示"当前用户无权进行转让"
- **网络错误**: 提示"网络连接失败"
