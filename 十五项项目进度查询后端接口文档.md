# 十五项项目进度查询后端接口文档

## 📋 数据库表结构

### 1. progress 表（项目进度表）
```sql
CREATE TABLE progress (
    id INT PRIMARY KEY AUTO_INCREMENT,
    project_id INT NOT NULL,                    -- 关联15projects表的项目ID
    progress_date DATE NOT NULL,                -- 进度日期
    progress_time TIME NOT NULL,                -- 进度时间
    location VARCHAR(255) NOT NULL,             -- 地点
    person_name VARCHAR(100) NOT NULL,          -- 负责人姓名
    person_phone VARCHAR(20),                   -- 负责人电话
    event_title VARCHAR(500) NOT NULL,          -- 事件标题
    event_details TEXT,                         -- 事件详细描述
    images JSON,                                -- 图片文件信息(JSON格式存储)
    news_files JSON,                            -- 新闻稿文件信息(JSON格式存储)
    status ENUM('active', 'deleted') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (project_id) REFERENCES 15projects(id)
);
```

### 2. 15projects 表（确保包含以下字段）
```sql
ALTER TABLE 15projects ADD COLUMN IF NOT EXISTS 
    objectives TEXT COMMENT '主要任务目标';
```

## 🔌 需要实现的后端接口

### 1. 获取十五项项目列表
**接口地址**: `GET /api/fifteen-projects/list`

**请求参数**:
```json
{
  "page": 1,
  "pageSize": 10,
  "keyword": "搜索关键词",
  "startDate": "2024-01-01",
  "endDate": "2024-12-31"
}
```

**响应格式**:
```json
{
  "success": true,
  "message": "获取成功",
  "projects": [
    {
      "id": 1,
      "projectName": "智慧城市基础设施建设项目",
      "projectType": "基础设施建设",
      "objectives": "建设覆盖全市的智慧城市基础设施网络...",
      "progress": 68,
      "status": "进行中",
      "createDate": "2024-01-15",
      "startDate": "2024-01-15",
      "endDate": "2024-12-31"
    }
  ],
  "total": 100,
  "currentPage": 1,
  "totalPages": 10
}
```

### 2. 获取项目进度列表
**接口地址**: `GET /api/progress/list`

**请求参数**:
```json
{
  "project_id": 1
}
```

**响应格式**:
```json
{
  "success": true,
  "message": "获取成功",
  "progressList": [
    {
      "id": 1,
      "project_id": 1,
      "date": "2024-01-15",
      "time": "09:00",
      "location": "市政府会议室",
      "person": "张三",
      "event": "项目启动会议召开，确定项目总体规划和实施方案",
      "details": "参会人员包括市领导、各部门负责人及技术专家...",
      "images": [
        {
          "id": 1,
          "fileName": "启动会议现场.jpg",
          "fileUrl": "/uploads/images/meeting1.jpg",
          "fileSize": 1024000
        }
      ],
      "newsFiles": [
        {
          "id": 1,
          "fileName": "项目启动新闻稿.docx",
          "fileUrl": "/uploads/files/news1.docx",
          "fileSize": 512000
        }
      ]
    }
  ]
}
```

### 3. 文件下载接口
**接口地址**: `GET /api/files/download`

**请求参数**:
```json
{
  "fileId": 1
}
```

**响应**: 直接返回文件流，支持断点续传

### 4. 图片访问接口
**接口地址**: `GET /uploads/images/{fileName}`

**说明**: 直接访问图片文件，支持缓存

## 📊 JSON字段格式说明

### images 字段格式
```json
[
  {
    "id": 1,
    "fileName": "文件名.jpg",
    "fileUrl": "/uploads/images/xxx.jpg",
    "fileSize": 1024000,
    "uploadTime": "2024-01-15 10:30:00"
  }
]
```

### newsFiles 字段格式
```json
[
  {
    "id": 1,
    "fileName": "新闻稿.docx",
    "fileUrl": "/uploads/files/xxx.docx",
    "fileSize": 512000,
    "uploadTime": "2024-01-15 10:30:00"
  }
]
```

## 🔐 权限验证

所有接口都需要在请求头中携带token：
```
Authorization: Bearer {token}
```

## 📝 前端调用示例

### 获取项目列表
```javascript
wx.request({
  url: 'http://127.0.0.1:5000/api/fifteen-projects/list',
  method: 'GET',
  data: {
    page: 1,
    pageSize: 10,
    keyword: '',
    startDate: '',
    endDate: ''
  },
  header: {
    'Authorization': `Bearer ${wx.getStorageSync('token')}`
  },
  success: (res) => {
    if (res.data.success) {
      // 处理项目列表数据
      this.setData({
        projectList: res.data.projects
      });
    }
  }
});
```

### 获取项目进度
```javascript
wx.request({
  url: 'http://127.0.0.1:5000/api/progress/list',
  method: 'GET',
  data: {
    project_id: projectId
  },
  header: {
    'Authorization': `Bearer ${wx.getStorageSync('token')}`
  },
  success: (res) => {
    if (res.data.success) {
      // 处理进度数据
      this.setData({
        projectProgressList: res.data.progressList
      });
    }
  }
});
```

### 文件下载
```javascript
wx.downloadFile({
  url: `http://127.0.0.1:5000/api/files/download?fileId=${fileId}`,
  header: {
    'Authorization': `Bearer ${wx.getStorageSync('token')}`
  },
  success: (res) => {
    if (res.statusCode === 200) {
      wx.openDocument({
        filePath: res.tempFilePath
      });
    }
  }
});
```

## 🚀 部署说明

1. **替换模拟数据**: 删除前端代码中的模拟数据部分
2. **启用API调用**: 取消注释真实的API调用代码
3. **配置服务器地址**: 修改API基础URL
4. **文件存储**: 确保服务器有足够的存储空间用于图片和文档
5. **权限验证**: 实现token验证机制

## 📋 开发优先级

1. **高优先级**: 
   - 项目列表接口
   - 项目进度列表接口
   
2. **中优先级**:
   - 图片访问接口
   - 基础文件下载
   
3. **低优先级**:
   - 高级文件下载功能
   - 文件缓存优化
