# 文件上传功能使用说明

## 问题解决

### 为什么文件上传不了？

之前文件上传失败的主要原因：

1. **文档选择是模拟的** - 之前使用模拟数据，没有真正调用微信API
2. **服务器地址错误** - 使用本地地址 `http://127.0.0.1:5000`，在真机上无法访问
3. **缺少错误处理** - 没有处理网络错误和服务器错误

## 修复内容

### 1. 真实文件选择
- ✅ 使用 `wx.chooseMessageFile()` API 选择文档文件
- ✅ 支持PDF、Word、Excel格式
- ✅ 添加文件类型过滤和验证

### 2. 环境配置
- ✅ 开发环境：模拟上传成功，便于测试
- ✅ 生产环境：实际上传到服务器
- ✅ 创建配置文件管理服务器地址

### 3. 错误处理
- ✅ 网络超时处理
- ✅ 服务器错误处理
- ✅ 文件格式验证

## 使用方法

### 开发环境
1. 在微信开发者工具中运行
2. 选择文件类型（PDF、Word、Excel、图片）
3. 系统会模拟上传成功，显示"文件上传成功（开发模式）"

### 生产环境
1. 在真机上运行小程序
2. 选择文件类型
3. 文件会实际上传到服务器

## 支持的文件类型

- **PDF文档** (.pdf)
- **Word文档** (.doc, .docx)
- **Excel文档** (.xlsx, .xls)
- **图片文件** (jpg, png, gif等)

## 配置说明

### 服务器地址配置
编辑 `config/api.js` 文件：

```javascript
// 生产环境配置
production: {
  baseUrl: 'https://your-server-domain.com', // 修改为你的服务器地址
  enableMock: false,
  timeout: 30000
}
```

### 开发环境配置
```javascript
// 开发环境配置
development: {
  baseUrl: 'http://127.0.0.1:5000',
  enableMock: true, // 启用模拟数据
  timeout: 10000
}
```

## 注意事项

1. **真机测试**：开发环境在真机上可能无法访问本地服务器
2. **网络权限**：确保小程序有网络访问权限
3. **文件大小**：建议文件大小不超过10MB
4. **服务器配置**：生产环境需要配置正确的服务器地址

## 故障排除

### 如果仍然上传失败：

1. **检查网络连接**
2. **确认服务器地址正确**
3. **查看控制台错误信息**
4. **检查文件格式是否支持**
5. **确认小程序权限设置**

### 常见错误信息：

- "选择文件失败" - 文件选择API调用失败
- "上传超时，请检查网络" - 网络连接超时
- "网络连接失败" - 无法连接到服务器
- "服务器响应异常" - 服务器返回格式错误 