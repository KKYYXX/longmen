# 十五项项目删改查询联通功能

## 功能概述

实现了十五项项目的查询、编辑、删除功能的完全联通，用户可以在查询页面直接进行删改操作，所有变更都会实时显示。

## 联通功能特性

### 🔍 **查询页面集成操作**
- **项目列表快捷操作**：每个项目卡片右侧提供编辑和删除按钮
- **详情弹窗操作**：项目详情弹窗头部提供编辑和删除按钮
- **实时数据更新**：所有操作后立即更新列表显示

### ✏️ **编辑功能联通**
- **一键跳转编辑**：从查询页面直接跳转到编辑页面
- **数据自动传递**：选中的项目数据自动传递给编辑页面
- **编辑模式识别**：编辑页面自动识别是编辑模式还是新增模式
- **返回自动刷新**：编辑完成返回时自动刷新查询页面数据

### 🗑️ **删除功能联通**
- **确认对话框**：删除前显示确认对话框，防止误操作
- **实时移除**：删除成功后立即从列表中移除项目
- **弹窗自动关闭**：如果删除的是当前查看的项目，自动关闭详情弹窗

## 操作流程

### 编辑项目流程
```
查询页面 → 点击编辑按钮 → 跳转编辑页面 → 修改内容 → 保存 → 返回查询页面 → 自动刷新显示
```

### 删除项目流程
```
查询页面 → 点击删除按钮 → 确认对话框 → 确认删除 → 从列表移除 → 显示删除成功
```

## 技术实现

### 数据传递机制
使用微信小程序的全局数据 `app.globalData` 进行页面间数据传递：

```javascript
// 全局数据结构
globalData: {
  editingProject: null,    // 正在编辑的项目数据
  updatedProject: null,    // 更新后的项目数据
  newProject: null         // 新添加的项目数据
}
```

### 页面联通逻辑

#### 查询页面 → 编辑页面
1. 用户点击编辑按钮
2. 将项目数据存储到 `app.globalData.editingProject`
3. 跳转到编辑页面并传递项目ID
4. 编辑页面自动加载项目数据并进入编辑模式

#### 编辑页面 → 查询页面
1. 用户完成编辑并保存
2. 将更新后的数据存储到 `app.globalData.updatedProject`
3. 返回查询页面
4. 查询页面 `onShow` 检测到更新数据，自动刷新列表

### 核心方法

#### 查询页面核心方法
```javascript
// 编辑项目
onEditProject(e) {
  const project = e.currentTarget.dataset.project;
  getApp().globalData.editingProject = project;
  wx.navigateTo({
    url: '/pages/fifteenprojects_modify/fifteenprojects_modify?projectId=' + project.id
  });
}

// 删除项目
onDeleteProject(e) {
  const project = e.currentTarget.dataset.project;
  this.showDeleteConfirm(project);
}

// 更新列表中的项目
updateProjectInList(updatedProject) {
  const projectList = this.data.projectList.map(item => {
    if (item.id === updatedProject.id) {
      return { ...item, ...updatedProject };
    }
    return item;
  });
  this.setData({ projectList });
}
```

#### 编辑页面核心方法
```javascript
// 页面加载时检测编辑模式
onLoad(options) {
  if (options.projectId) {
    this.setData({
      editMode: true,
      editingProjectId: parseInt(options.projectId)
    });
    
    const app = getApp();
    if (app.globalData.editingProject) {
      this.setData({
        selectedProject: app.globalData.editingProject,
        currentStep: 2 // 直接跳到选择列的步骤
      });
    }
  }
}

// 保存时区分编辑和新增模式
saveModification() {
  // ... 保存逻辑 ...
  
  if (isSuccess) {
    const app = getApp();
    app.globalData.updatedProject = updatedProject;
    
    if (this.data.editMode) {
      wx.navigateBack(); // 编辑模式返回
    } else {
      // 新增模式重置状态
    }
  }
}
```

## 用户界面

### 查询页面操作按钮
- **项目列表**：每个项目右侧显示编辑(✏️)和删除(🗑️)圆形按钮
- **详情弹窗**：头部显示编辑和删除按钮，样式统一

### 按钮样式特色
- **编辑按钮**：浅黄色渐变背景，与主题色协调
- **删除按钮**：浅红色渐变背景，警示作用
- **悬停效果**：按钮有缩放动画，提供良好的交互反馈

## 数据库接口预留

所有功能都预留了后端API接口调用位置：

### 编辑接口
```javascript
// PUT /api/fifteen-projects/{id}
wx.request({
  url: `http://127.0.0.1:5000/api/fifteen-projects/${project.id}`,
  method: 'PUT',
  data: updatedData,
  header: {
    'Authorization': `Bearer ${wx.getStorageSync('token')}`
  }
});
```

### 删除接口
```javascript
// DELETE /api/fifteen-projects/{id}
wx.request({
  url: `http://127.0.0.1:5000/api/fifteen-projects/${project.id}`,
  method: 'DELETE',
  header: {
    'Authorization': `Bearer ${wx.getStorageSync('token')}`
  }
});
```

### 查询接口
```javascript
// GET /api/fifteen-projects/list
wx.request({
  url: 'http://127.0.0.1:5000/api/fifteen-projects/list',
  method: 'GET',
  data: {
    page: this.data.page,
    pageSize: this.data.pageSize,
    keyword: this.data.searchKeyword,
    startDate: this.data.startDate,
    endDate: this.data.endDate
  }
});
```

## 使用说明

### 编辑项目
1. 在查询页面找到要编辑的项目
2. 点击项目卡片右侧的编辑按钮(✏️)或详情弹窗中的编辑按钮
3. 自动跳转到编辑页面，项目已预选
4. 选择要修改的列，进行编辑或添加内容
5. 保存后自动返回查询页面，可看到更新后的内容

### 删除项目
1. 在查询页面找到要删除的项目
2. 点击项目卡片右侧的删除按钮(🗑️)或详情弹窗中的删除按钮
3. 在确认对话框中点击"删除"
4. 项目立即从列表中移除，显示删除成功提示

### 查看进度记录
1. 点击项目卡片查看详情
2. 在详情弹窗中选择时间范围
3. 查看该时间段内的"某人某时某地干了某事"记录

## 优势特点

- **操作便捷**：无需跳转多个页面，在查询页面即可完成所有操作
- **数据同步**：所有操作立即反映在界面上，无需手动刷新
- **用户友好**：清晰的操作反馈和确认机制
- **扩展性强**：预留完整的后端接口，易于接入真实数据库
- **一致性好**：所有操作保持统一的视觉风格和交互模式
