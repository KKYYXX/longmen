# 项目查询权限人员功能实现说明

## 功能概述

本项目查询权限人员页面已经完成了与后端接口的对接，实现了以下功能：

### 一、页面加载时调用查询接口

**接口地址：** `http://127.0.0.1:5000/user/query_15`
**请求方式：** GET
**功能：** 获取所有具有项目查询权限的人员列表

**实现逻辑：**
1. 页面加载时自动调用 `fetchRecords()` 方法
2. 发送GET请求到后端接口
3. 接收返回的人员数据（包含name和phone字段）
4. 将数据展示在页面列表中
5. 显示人员数量统计

**后端返回数据格式：**
```json
[
  {
    "name": "张三",
    "phone": "13800138000"
  },
  {
    "name": "李四", 
    "phone": "13900139000"
  }
]
```

### 二、删除功能实现

**接口地址：** `http://127.0.0.1:5000/user/query_15_delete`
**请求方式：** POST
**功能：** 删除指定人员的项目查询权限

**实现逻辑：**
1. 每条记录后面都有删除按钮
2. 点击删除按钮时，弹出确认对话框
3. 确认删除后，调用后端删除接口
4. 传递该记录的name和phone参数
5. 删除成功后重新获取数据列表
6. 显示操作结果提示

**请求参数：**
```json
{
  "name": "张三",
  "phone": "13800138000"
}
```

### 三、页面功能特性

1. **搜索功能：** 支持按姓名或手机号搜索
2. **实时统计：** 显示当前筛选后的记录数量
3. **响应式设计：** 适配不同屏幕尺寸
4. **交互反馈：** 删除按钮有点击效果
5. **错误处理：** 完善的错误提示机制

### 四、文件结构

```
pages/项目查询权限人员/
├── 项目查询权限人员.js    # 页面逻辑
├── 项目查询权限人员.wxml  # 页面结构
├── 项目查询权限人员.wxss  # 页面样式
└── 项目查询权限人员.json  # 页面配置
```

### 五、关键代码说明

**查询接口调用：**
```javascript
fetchRecords() {
  wx.request({
    url: 'http://127.0.0.1:5000/user/query_15',
    method: 'GET',
    success: res => {
      if (res.statusCode === 200) {
        const records = res.data || [];
        this.setData({
          allRecords: records,
          filteredRecords: records
        })
      }
    }
  })
}
```

**删除接口调用：**
```javascript
onDeleteRecord(e) {
  const index = e.currentTarget.dataset.index
  const record = this.data.filteredRecords[index]
  
  wx.request({
    url: 'http://127.0.0.1:5000/user/query_15_delete',
    method: 'POST',
    header: { 'content-type': 'application/x-www-form-urlencoded' },
    data: { 
      name: record.name,
      phone: record.phone 
    },
    success: res => {
      if (res.statusCode === 200) {
        this.fetchRecords() // 重新获取数据
        this.showToast('删除成功')
      }
    }
  })
}
```

### 六、测试建议

1. **接口测试：** 确保后端服务正常运行在5000端口
2. **数据测试：** 验证查询接口返回正确的数据格式
3. **删除测试：** 测试删除功能是否正常工作
4. **错误测试：** 测试网络异常等错误情况的处理

### 七、注意事项

1. 确保后端服务地址正确（当前配置为127.0.0.1:5000）
2. 删除操作需要用户确认，避免误操作
3. 所有网络请求都有错误处理机制
4. 删除成功后会自动刷新数据列表

## 完成状态

✅ 查询接口对接完成  
✅ 删除接口对接完成  
✅ 页面UI优化完成  
✅ 错误处理机制完善  
✅ 用户交互体验优化 